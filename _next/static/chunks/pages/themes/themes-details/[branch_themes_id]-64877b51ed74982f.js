(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9189],{50204:function(e,a,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/themes/themes-details/[branch_themes_id]",function(){return s(96496)}])},70442:function(e,a,s){"use strict";s.d(a,{Z:function(){return f}});var t=s(85893),n=s(67294),r=s(41664),l=s.n(r),c=s(25675),i=s.n(c),o=s(11163),d=s(35122),m=s.n(d),p=s(87006),h=s(7419),u=s(40911),_=s(1030),x=s(75557),g=s(83979),j=s(92088);function f(e){let{branchName:a="",themeImg:s="",themeName:r="",difficulty:c="",introduction:d="",min_players:f="",max_players:v="",themeTime:b=0,branch_themes_id:y}=e,N=(0,o.useRouter)(),[C,S]=(0,n.useState)(!1);return(0,t.jsxs)(p.Z,{variant:"plain",sx:{"--Card-radius":"0px",p:0},className:m()["card-02"],children:[(0,t.jsxs)(h.Z,{sx:{position:"relative"},children:[(0,t.jsx)(u.ZP,{sx:{position:"absolute",top:"15px",left:"15px",color:"#FFFFFF",zIndex:1},children:a}),(0,t.jsx)(_.Z,{ratio:"375/240",children:(0,t.jsx)(i(),{src:"/themes-main/".concat(s.replace(/\.[^/.]+$/,".png")),alt:"",width:375,height:240})}),(0,t.jsxs)(x.Z,{sx:{position:"absolute",bottom:"-20px",left:"25px",display:"flex",flexDirection:"row",alignItems:"center"},children:[(0,t.jsx)(u.ZP,{sx:{bgcolor:"#222222",color:"#FFFFFF",width:160,height:40,display:"flex",alignItems:"center",justifyContent:"center"},children:r}),(0,t.jsx)(u.ZP,{sx:{bgcolor:(e=>{switch(e){case"EASY":return"#63AA90";case"MEDIUM":return"#B99755";case"HARD":return"#A43131";default:return"#222222"}})(c),color:"#FFFFFF",width:100,height:40,display:"flex",alignItems:"center",justifyContent:"center"},children:c})]})]}),(0,t.jsx)(g.Z,{sx:{pt:3,pb:.6,px:{xs:4,sm:6},justifyContent:"center"},children:(0,t.jsx)("span",{children:d})}),(0,t.jsx)(h.Z,{children:(0,t.jsxs)(g.Z,{sx:{px:5,pb:{xs:3,sm:12},display:"flex",flexDirection:{xs:"column",sm:"row"},alignItems:{xs:"flex-start",sm:"center"},justifyContent:"space-between"},children:[(0,t.jsxs)(x.Z,{sx:{display:"flex",flexDirection:"row",alignItems:"center",mb:{xs:2,sm:0}},children:[(0,t.jsx)(u.ZP,{mr:2,startDecorator:(0,t.jsx)(j.SWH,{}),children:"".concat(f,"-").concat(v," 人")}),(0,t.jsx)(u.ZP,{startDecorator:(0,t.jsx)(j.iNe,{}),children:"".concat(b," 分鐘")})]}),(0,t.jsx)(x.Z,{sx:{display:"flex",justifyContent:{xs:"flex-start",sm:"flex-end"},width:{xs:"100%",sm:"auto"}},children:(0,t.jsx)(l(),{href:"#",onClick:e=>{e.preventDefault(),S(!C),N.push("/themes/themes-details/".concat(y))},className:m().bookingButton,onMouseEnter:e=>{e.target.style.backgroundColor="#222222",e.target.style.color="white"},onMouseLeave:e=>{e.target.style.backgroundColor=C?"#222222":"white",e.target.style.color=C?"white":"#222222"},children:"立即預訂"})})]})})]})}},96496:function(e,a,s){"use strict";s.r(a),s.d(a,{default:function(){return eq}});var t=s(85893),n=s(67294),r=s(11163),l=s(53483),c=s(19215),i=s(375),o=s(29100),d=s.n(o),m=s(45747),p=s(70442),h=s(96486),u=s.n(h);function _(){let[e,a]=(0,n.useState)([]);return(0,n.useEffect)(()=>{fetch("".concat(m.Ah,"?branch_id=1")).then(e=>e.json()).then(e=>{a(u().shuffle(e.themes).map(e=>({...e,branch_themes_id:e.branch_themes_id||e.theme_id})).slice(0,3))}).catch(e=>{console.error("Error fetching themes:",e)})},[]),(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)("div",{className:"container",children:[(0,t.jsx)("h2",{className:d().h1,children:"More Themes"}),(0,t.jsx)("div",{className:"row mt-5 d-flex justify-content-evenly ",children:(0,t.jsx)("div",{className:"d-flex justify-content-evenly flex-wrap",children:e.map(e=>(0,t.jsx)(p.Z,{branchName:e.branch_name,themeImg:e.theme_img,themeName:e.theme_name,difficulty:e.difficulty,introduction:e.introduction,min_players:e.min_players,max_players:e.max_players,themeTime:e.theme_time,branch_themes_id:e.branch_themes_id},e.theme_id))})})]})})}var x=s(40756),g=s.n(x);s(48059);var j=s(25675),f=s.n(j);function v(e){let{targetId:a}=e,[s,r]=(0,n.useState)(!0);return(0,n.useEffect)(()=>{let e=()=>{window.scrollY>0?r(!1):r(!0)};return window.addEventListener("scroll",e),()=>{window.removeEventListener("scroll",e)}},[]),(0,t.jsx)(t.Fragment,{children:(0,t.jsx)("button",{onClick:()=>{let e=document.getElementById(a);if(e){let a=e.getBoundingClientRect().top+window.pageYOffset;window.scrollTo({top:a-130,behavior:"smooth"})}},className:"".concat(g()["top-btn"]," ").concat(s?g().visible:""),children:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(f(),{src:"/ghost/ghost_08.png",alt:"top-button-default",width:130,height:110,className:"".concat(g().default," animate__animated animate__pulse animate__infinite animate__slow"),priority:!1}),(0,t.jsx)(f(),{src:"/ghost/ghost_21.png",alt:"top-button-hover",width:130,height:110,className:"".concat(g().hover," animate__animated animate__tada animate__infinite"),priority:!1})]})})})}var b=s(70009),y=s.n(b);let N=["/game/01.png","/game/02.png","/game/03.png","/game/04.png","/game/05.png","/game/06.png"],C={name:"鑰匙鬼鬼",image:"/game/key.png"},S=[{x:"26%",y:"14%"},{x:"31.8%",y:"84.5%"},{x:"66%",y:"20%"},{x:"71%",y:"82%"},{x:"79%",y:"51%"}],E=[{question:"什麼東西在桌上可以看到，卻永遠無法使用？",answer:"影子"},{question:"每一天都帶來光明和溫暖，但你永遠無法直視他？",answer:"太陽"},{question:"什麼東西能打開所有鎖，但自己卻永遠關不上？",answer:"鑰匙"}],k={gameStarted:!1,currentTab:1,cards:[],flippedCards:[],matchedPairs:0,foundDifferences:[],solvedRiddles:0,isProcessing:!1,message:"",showLevelComplete:[!1,!1,!1],gameCompleted:!1},w=(e,a)=>{let s=e=>({...e,foundDifferences:Array.isArray(e.foundDifferences)?e.foundDifferences:[]});switch(a.type){case"START_GAME":return s({...e,gameStarted:!0});case"INIT_LEVEL1":return s({...e,cards:a.payload,matchedPairs:0,flippedCards:[]});case"FLIP_CARD":return s({...e,cards:a.payload.cards,flippedCards:a.payload.flippedCards,isProcessing:2===a.payload.flippedCards.length});case"MATCH_PAIR":return s({...e,matchedPairs:e.matchedPairs+1,flippedCards:[],isProcessing:!1});case"NO_MATCH":return s({...e,cards:a.payload,flippedCards:[],isProcessing:!1});case"FOUND_DIFFERENCE":return s({...e,foundDifferences:[...e.foundDifferences||[],a.payload]});case"SOLVE_RIDDLE":return s({...e,solvedRiddles:e.solvedRiddles+1});case"SET_MESSAGE":return s({...e,message:a.payload});case"SHOW_LEVEL_COMPLETE":{let a=[...e.showLevelComplete];return a[e.currentTab-1]=!0,s({...e,showLevelComplete:a})}case"HIDE_LEVEL_COMPLETE":{let t=[...e.showLevelComplete];return t[a.payload-1]=!1,s({...e,showLevelComplete:t})}case"COMPLETE_GAME":return s({...e,gameCompleted:!0});case"RESET_LEVEL2":return s({...e,foundDifferences:[]});case"CHANGE_TAB":return s({...e,currentTab:a.payload});default:return s(e)}},T=e=>{let a=[...e];for(let e=a.length-1;e>0;e--){let s=Math.floor(Math.random()*(e+1));[a[e],a[s]]=[a[s],a[e]]}return a},I=n.memo(e=>{let{card:a,onClick:s,index:n}=e;return(0,t.jsx)("div",{className:"".concat(y().card," ").concat(a.flipped?y().cardFlipped:""),onClick:s,onKeyPress:e=>{("Enter"===e.key||" "===e.key)&&s()},style:{"--rotation":a.flipped?"180deg":"0deg"},role:"button",tabIndex:"0","aria-label":"Card ".concat(n+1).concat(a.flipped?", flipped":""),children:(0,t.jsxs)("div",{className:y().cardInner,children:[(0,t.jsx)("div",{className:"".concat(y().cardFace," ").concat(y().cardFront),style:{backgroundImage:"url(".concat(a.image,")")}}),(0,t.jsx)("div",{className:"".concat(y().cardFace," ").concat(y().cardBack),style:{backgroundImage:"url(".concat("/game/card.jpg",")")}})]})})});function F(){let[e,a]=(0,n.useReducer)(w,k);(0,n.useEffect)(()=>{e.gameStarted&&1===e.currentTab&&0===e.cards.length?a({type:"INIT_LEVEL1",payload:T([...N,...N]).map((e,a)=>({image:e,index:a,flipped:!1}))}):2===e.currentTab&&a({type:"RESET_LEVEL2"})},[e.gameStarted,e.currentTab,e.cards.length]);let s=(0,n.useCallback)(s=>{let[t,n]=s;t.image===n.image?(a({type:"MATCH_PAIR"}),e.matchedPairs+1===6&&a({type:"SHOW_LEVEL_COMPLETE"})):setTimeout(()=>{let s=[...e.cards];s[t.index].flipped=!1,s[n.index].flipped=!1,a({type:"NO_MATCH",payload:s})},500)},[e.cards,e.matchedPairs]),r=(0,n.useCallback)(t=>{if(e.isProcessing||e.flippedCards.length>=2||e.cards[t].flipped)return;let n=[...e.cards];n[t].flipped=!0;let r=[...e.flippedCards,{...n[t],index:t}];a({type:"FLIP_CARD",payload:{cards:n,flippedCards:r}}),2===r.length&&setTimeout(()=>s(r),300)},[e.cards,e.flippedCards,e.isProcessing,s]),l=(0,n.useCallback)(s=>{e.foundDifferences.includes(s)||(a({type:"FOUND_DIFFERENCE",payload:s}),e.foundDifferences.length+1===S.length&&a({type:"SHOW_LEVEL_COMPLETE"})),a({type:"SET_MESSAGE",payload:""})},[e.foundDifferences]),c=(0,n.useCallback)((s,t)=>{t.toLowerCase()===E[s].answer.toLowerCase()?(a({type:"SET_MESSAGE",payload:"回答正確！"}),a({type:"SOLVE_RIDDLE"}),e.solvedRiddles+1===E.length?setTimeout(()=>{a({type:"SHOW_LEVEL_COMPLETE"})},500):setTimeout(()=>{a({type:"SET_MESSAGE",payload:""})},1e3)):(a({type:"SET_MESSAGE",payload:"回答錯誤，請再試一次。"}),setTimeout(()=>{a({type:"SET_MESSAGE",payload:""})},1e3))},[e.solvedRiddles]),i=(0,n.useCallback)(e=>{a({type:"CHANGE_TAB",payload:e})},[]),o=(0,n.useMemo)(()=>e.cards.map((e,a)=>(0,t.jsx)(I,{card:e,onClick:()=>r(a)},a)),[e.cards,r]);return(0,t.jsxs)("div",{className:"container mt-2 d-block justify-content-center",children:[!e.gameStarted&&(0,t.jsx)(()=>(0,t.jsxs)("div",{className:"container",children:[(0,t.jsx)("h1",{className:y().title,children:"\\密室逃脫小遊戲/"}),(0,t.jsxs)("div",{className:y().introScreen,children:[(0,t.jsx)("img",{src:"/game/intro.png",alt:"Intro",className:y().introImage}),(0,t.jsxs)("p",{className:y().p,children:["在前往密室逃脫前，玩個小遊戲，",(0,t.jsx)("br",{}),"準備好挑戰你的觀察力和智慧了嗎？"]}),(0,t.jsx)("button",{className:y().startButton,onClick:()=>a({type:"START_GAME"}),children:"開始遊戲"})]})]}),{}),e.gameStarted&&!e.gameCompleted&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("h1",{className:y().title,children:"\\密室逃脫小遊戲/"}),e.message&&(0,t.jsx)("div",{className:y().message,children:e.message}),e.showLevelComplete[e.currentTab-1]?(0,t.jsx)(e=>{let{level:s}=e;return(0,t.jsxs)("div",{className:y().levelCompleteScreen,children:[(0,t.jsxs)("h2",{className:y().title2,children:["恭喜完成第",s,"關！"]}),(0,t.jsx)("div",{children:(0,t.jsx)("img",{src:"/game/complete".concat(s,".png"),alt:"Level ".concat(s," Complete"),className:y().levelCompleteImage})}),(0,t.jsx)("button",{className:y().nextLevelButton,onClick:()=>a({type:"HIDE_LEVEL_COMPLETE",payload:s}),children:"返回遊戲"})]})},{level:e.currentTab}):(0,t.jsx)(()=>(0,t.jsxs)("div",{className:y().gameContent,children:[(0,t.jsx)("div",{className:y().tabsContainer,children:(0,t.jsx)("div",{className:y().tabs,children:[1,2,3].map((a,s)=>(0,t.jsxs)(n.Fragment,{children:[(0,t.jsx)("button",{onClick:()=>i(a),className:"".concat(y().tabButton," ").concat(e.currentTab===a?y().activeTab:""),children:a}),s<2&&(0,t.jsx)("div",{className:y().tabDivider})]},a))})}),1===e.currentTab&&(0,t.jsxs)("div",{className:y().level,children:[(0,t.jsx)("h2",{className:y().title2,children:"第一關：翻牌配對"}),(0,t.jsx)("div",{className:y().cardGrid,children:o})]}),2===e.currentTab&&(0,t.jsxs)("div",{className:y().level,children:[(0,t.jsx)("h2",{className:y().title2,children:"第二關：尋找物品"}),(0,t.jsxs)("div",{className:y().objectToFindContainer,children:[(0,t.jsx)("img",{src:C.image,alt:C.name,className:y().objectToFindImage}),(0,t.jsxs)("p",{children:["在圖片中找出所有的",C.name,"（共",S.length,"個）"]})]}),(0,t.jsx)("div",{className:y().imageComparisonContainer,children:(0,t.jsxs)("div",{className:y().imageWrapper,children:[(0,t.jsx)("img",{className:y().image,src:"/game/find.jpg",alt:"尋找物品場景"}),S.map((a,s)=>(0,t.jsx)("button",{className:"".concat(y().difference," ").concat(e.foundDifferences.includes(s)?y().found:""),style:{left:a.x,top:a.y},onClick:()=>l(s),onKeyPress:e=>{("Enter"===e.key||" "===e.key)&&l(s)},"aria-label":"".concat(C.name," ").concat(s+1)},s))]})}),(0,t.jsxs)("p",{className:y().p2,children:["找到的",C.name,"：",e.foundDifferences.length,"/",S.length]})]}),3===e.currentTab&&(0,t.jsxs)("div",{className:y().level,children:[(0,t.jsx)("h2",{className:y().title2,children:"第三關：謎語遊戲"}),(0,t.jsx)("p",{className:y().p,children:"回答以下三個謎題以通關："}),(0,t.jsx)("div",{className:y().riddleContainer,children:E.map((e,a)=>(0,t.jsxs)("div",{className:y().riddle,children:[(0,t.jsxs)("p",{children:[a+1,". ",e.question]}),(0,t.jsx)("input",{type:"text",placeholder:"請輸入答案",onKeyPress:e=>{"Enter"===e.key&&c(a,e.target.value)}})]},a))})]})]}),{})]}),e.gameCompleted&&(0,t.jsx)(()=>(0,t.jsxs)("div",{className:y().gameCompletedScreen,children:[(0,t.jsx)("h2",{children:"恭喜你完成所有關卡！"}),(0,t.jsx)("div",{className:"mt-4",children:(0,t.jsx)("img",{src:"/game/complete3.png",alt:"Game Completed",className:y().gameCompletedImage})}),(0,t.jsx)("p",{children:"你成功逃出密室了！"})]}),{})]})}I.displayName="Card";let B=e=>{let{children:a}=e,s=(0,n.useRef)(null),r=(0,c.Y)(s,{once:!0});return(0,t.jsx)(i.E.div,{ref:s,initial:{opacity:0,y:50},animate:r?{opacity:1,y:0}:{opacity:0,y:50},transition:{duration:1},children:a})};function L(e){let{Banner:a,Item:s,Step:r,Calendar:l}=e,c=(0,n.useRef)(null);return(0,n.useEffect)(()=>{let e=e=>{let a=c.current;if(a){let s=a.getBoundingClientRect();s.top<=0&&s.bottom>window.innerHeight&&e.preventDefault()}};return window.addEventListener("scroll",e,{passive:!1}),()=>window.removeEventListener("scroll",e)},[]),(0,t.jsxs)("div",{ref:c,children:[a,(0,t.jsx)(B,{children:s}),(0,t.jsx)(B,{children:(0,t.jsx)("div",{id:"step-section",children:r})}),(0,t.jsx)(B,{children:l}),(0,t.jsx)(v,{targetId:"step-section"}),(0,t.jsx)(B,{children:(0,t.jsx)(F,{})}),(0,t.jsx)(B,{children:(0,t.jsx)(_,{})})]})}let D=(0,n.createContext)();function M(){return(0,n.useContext)(D)}let P=e=>{let{children:a}=e,[s,r]=(0,n.useState)(null),l=(0,n.useCallback)(async(e,a)=>{console.log("Fetching theme details for branch_themes_id: ".concat(e,", user_id: ").concat(a));try{let s=await fetch("".concat(m.yy,"/").concat(e,"?user_id=").concat(a));if(!s.ok)throw Error("HTTP error! status: ".concat(s.status));let t=await s.json();if(console.log("Fetched theme details:",t),t.success&&t.theme)return r(t.theme),console.log("Theme details updated in context"),t.theme;throw console.error("Invalid data structure:",t),Error("Invalid data structure")}catch(e){throw console.error("Error in getThemeDetails:",e),e}},[]),c=(0,n.useCallback)(async(e,a)=>{console.log("Updating available coupons for branch_themes_id: ".concat(e,", user_id: ").concat(a));try{let s=await l(e,a);return console.log("Updated available coupons:",s.available_coupons),s.available_coupons}catch(e){throw console.error("Error updating available coupons:",e),e}},[l]),i=(0,n.useCallback)(()=>{console.log("Clearing theme details from context"),r(null)},[]);return(0,t.jsx)(D.Provider,{value:{themeDetails:s,getThemeDetails:l,updateAvailableCoupons:c,clearThemeDetails:i},children:a})};var R=s(90167),A=s.n(R),O=s(78773),Z=s(41869),H=s(59154),z=s(98163),q=s(2051),W=s.n(q);function G(e){let{modalTitle:a="Modal Title",modalBody:s,open:n,onClose:r,modalW:l="800px",modalH:c="700px"}=e;return(0,t.jsx)(H.Z,{open:n,onClose:()=>{},children:(0,t.jsxs)(Z.Z,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"var(--modal-width)",height:"var(--modal-height)",bgcolor:"background.paper",borderRadius:"1rem",boxShadow:"var(--card-shadow)",padding:"2.5rem","--modal-width":l,"--modal-height":c,display:"flex",flexDirection:"column"},className:W().modalBox,children:[(0,t.jsx)("h6",{className:W().modalHeader,children:a}),(0,t.jsx)("hr",{}),(0,t.jsx)("div",{className:W().modalContent,children:s}),(0,t.jsx)("hr",{}),(0,t.jsx)("div",{className:W().modalFooter,children:"如有任何疑問請直接私訊粉絲團或來電 0928-007799/0907-101822"}),(0,t.jsx)("div",{className:W().buttonContainer,children:(0,t.jsx)(z.Z,{sx:{border:"1px solid black",fontFamily:"Noto Serif JP",fontSize:"16px",borderRadius:"30px",backgroundColor:"white",color:"#222222",padding:"10px 30px","&:hover":{backgroundColor:"#222222",color:"white",boxShadow:"none"},boxShadow:"none"},variant:"contained",onClick:r,children:"確定"})})]})})}var Y=()=>{let{themeDetails:e,getThemeDetails:a}=M(),[s,l]=(0,n.useState)(!1),[c,o]=(0,n.useState)(!0),[d,m]=(0,n.useState)(!1),p=(0,r.useRouter)(),[h,u]=(0,n.useState)(!1),_=(0,n.useRef)(null),[x,g]=(0,n.useState)([]),[j,f]=(0,n.useState)(!1),[v,b]=(0,n.useState)(!1),[y,N]=(0,n.useState)(null),C=(0,n.useCallback)(e=>{e.preventDefault(),v&&_.current&&(_.current.paused?_.current.play().then(()=>u(!0)).catch(e=>{console.error("播放失敗:",e),u(!1)}):(_.current.pause(),u(!1)))},[v]),S=(0,n.useCallback)(()=>{f(!1),v&&_.current&&_.current.play().then(()=>u(!0)).catch(e=>{console.error("播放失敗:",e),u(!1)})},[v]),E=(0,n.useCallback)(()=>{f(!1)},[]);(0,n.useEffect)(()=>{let e=e=>{let a=new URL(e,window.location.origin).searchParams.get("branch_themes_id");a!==y&&(_.current&&(_.current.pause(),u(!1)),f(!0),N(a))};return p.events.on("routeChangeStart",e),()=>{p.events.off("routeChangeStart",e)}},[p,y]),(0,n.useEffect)(()=>{let{branch_themes_id:e}=p.query;e&&e!==y&&(o(!0),m(!1),b(!1),N(e),a(e).finally(()=>{o(!1),f(!0)})),g(Array.from({length:20},()=>({minHeight:Math.floor(3*Math.random())+3,maxHeight:Math.floor(7*Math.random())+20,delay:.5*Math.random()})))},[p.query,a,y]),(0,n.useEffect)(()=>{e.bg_music&&_.current&&(_.current.src="/music/".concat(e.bg_music),b(!1),u(!1)),e.theme_mp4&&m(!1)},[e.bg_music,e.theme_mp4]),(0,n.useEffect)(()=>{let e=_.current;if(!e)return;let a=()=>{b(!0)},s=e=>console.error("音訊錯誤:",e);return e.addEventListener("canplaythrough",a),e.addEventListener("error",s),()=>{e.removeEventListener("canplaythrough",a),e.removeEventListener("error",s)}},[e.bg_music]);let k=(0,n.useCallback)(e=>Array.from({length:e},(e,a)=>(0,t.jsx)(O.QJe,{style:{marginRight:"6px"}},a)),[]);return(0,t.jsxs)("div",{style:{position:"relative",minHeight:"calc(100vh - 100px)",display:"flex",alignItems:"center",overflow:"hidden"},children:[(0,t.jsxs)("video",{autoPlay:!0,loop:!0,muted:!0,playsInline:!0,onLoadedData:()=>m(!0),style:{position:"absolute",width:"100%",height:"100%",objectFit:"cover",zIndex:1,display:d?"block":"none"},children:[(0,t.jsx)("source",{src:"/mp4/".concat(e.theme_mp4),type:"video/mp4"}),"您的瀏覽器不支援 video 標籤。"]},e.theme_mp4),(0,t.jsx)("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:"linear-gradient(to top, rgba(0, 0, 0, 0.5), rgba(155, 155, 155, 0.1))",zIndex:2}}),(0,t.jsx)(()=>(0,t.jsx)(i.E.div,{animate:{opacity:[.1,.15,.1],backgroundPosition:["0% 0%","130% 100%","56% 0%"]},transition:{repeat:1/0,duration:.05,ease:"linear"},style:{backgroundImage:'url("/noise2.jpg")',position:"absolute",top:0,left:0,right:0,bottom:0,backgroundSize:"150% 100%",pointerEvents:"none",opacity:1,zIndex:3},className:"absolute inset-0"}),{}),(0,t.jsx)("div",{className:"container px-5 md-px-1",style:{position:"relative",zIndex:4},children:(0,t.jsx)("div",{className:"row",children:(0,t.jsxs)("div",{className:"col-12 col-md-6",children:[(0,t.jsx)("h1",{className:A().h1,children:e.theme_name}),(0,t.jsx)("p",{className:A().p,children:e.theme_desc}),(0,t.jsx)("hr",{className:A().hr}),(0,t.jsxs)("div",{className:A().comment,children:[(0,t.jsxs)("div",{className:A().section,children:[(0,t.jsx)("span",{className:A().title,children:"主題與劇情"}),(0,t.jsx)("span",{className:A().star,children:k(e.storyline)})]}),(0,t.jsxs)("div",{className:A().section,children:[(0,t.jsx)("span",{className:A().title,children:"謎題與設計"}),(0,t.jsx)("span",{className:A().star,children:k(e.puzzle_design)})]}),(0,t.jsxs)("div",{className:A().section,children:[(0,t.jsx)("span",{className:A().title,children:"環境與氛圍"}),(0,t.jsx)("span",{className:A().star,children:k(e.atmosphere)}),(0,t.jsx)("button",{className:A().warning,onClick:e=>{e.preventDefault(),l(!0)},children:"注意事項"})]})]})]})})}),(0,t.jsxs)("div",{className:A().play,children:[(0,t.jsxs)("div",{className:A().playerWrapper,children:[h&&(0,t.jsx)("div",{className:A().soundBarsContainer,children:x.map((e,a)=>(0,t.jsx)("div",{className:A().soundBar,style:{"--min-height":"".concat(e.minHeight,"px"),"--max-height":"".concat(e.maxHeight,"px"),animationDelay:"".concat(e.delay,"s")}},a))}),(0,t.jsx)("div",{className:"d-flex justify-content-center align-items-center",style:{height:"100%"},children:(0,t.jsx)("button",{onClick:C,className:A().playerButton,children:h?(0,t.jsx)(O.Wh,{}):(0,t.jsx)(O.gmG,{})})})]}),(0,t.jsxs)("audio",{ref:_,loop:!0,children:[(0,t.jsx)("source",{src:"/music/".concat(e.bg_music),type:"audio/mpeg"}),"您的瀏覽器不支援 audio 元素。"]})]}),j&&(0,t.jsx)("div",{className:A().musicPromptOverlay,children:(0,t.jsxs)("div",{className:A().musicPrompt,children:[(0,t.jsx)("p",{children:"是否播放背景音樂來增強您的體驗？"}),(0,t.jsxs)("div",{className:A().musicPromptButtons,children:[(0,t.jsx)("button",{className:A().acceptButton,onClick:S,children:"播放音樂"}),(0,t.jsx)("button",{className:A().declineButton,onClick:E,children:"不要播放"})]})]})}),(0,t.jsx)(G,{open:s,onClose:()=>l(!1),modalTitle:"注意事項",modalBody:(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:A().p1,children:"1. 活動採包場制，不協助並團，預約須達「遊戲最低人數」。"}),(0,t.jsx)("p",{className:A().p1,children:"2. 變更或取消預訂日期，請於預約日前一日來電通知。臨時取消將會影響您下次預約的優先權利。"}),(0,t.jsx)("p",{className:A().p1,children:"3. 在遊戲人數範圍內可以臨時追加人數，不需與客服聯繫，當日將以現場人數收費。遇天災或不可抗力因素取消或變更場次，以網站公告為準。"}),(0,t.jsxs)("p",{className:A().p1,children:["4. 請「準時到場」集合報到，現場以",(0,t.jsx)("span",{style:{color:"#B99755",fontWeight:"bold"},children:"現金收費"}),"並進行事前說明。超過表定時間未報到入場，即取消場次，開放給現場玩家預約。"]}),(0,t.jsx)("p",{className:A().p1,children:"5. 活動流程包含事前說明、進行密室逃脫、遊戲後故事解說（無全程謎題講解）。"}),(0,t.jsxs)("p",{className:A().p1,children:["6. 遊玩人數低於建議人數時難度較高，不足開場人數時將導致活動無法進行。本遊戲因場景及遊戲設計，",(0,t.jsx)("span",{className:A().p3,children:"未滿12歲、孕婦及行動不便者不得入場"}),"。"]}),(0,t.jsx)("p",{className:A().p1,children:"8. 如因年齡未達遊戲主題限制，本工作室有權拒絕玩家入場，並不得將未成年孩童托管在場館內。如有特殊需求（嬰兒車、寵物等），請先來電詢問。"}),(0,t.jsx)("p",{className:A().p1,children:"9. 遊戲期間請勿飲食、攝影及錄音。"}),(0,t.jsx)("p",{className:A().p1,children:"10. 場內設置各項活動機關，請「穿著方便活動的衣物」。"}),(0,t.jsx)("p",{className:A().p3,children:"遊戲過程中如有毀損道具及場景之行為，造成本工作室損失，將提出求償。（包含道具維修、場景修復、營業損失之費用等等）。"})]})})]})},J=s(37887),V=s.n(J),U=s(84295),K=s(65890);function Q(){let{themeDetails:e,getThemeDetails:a}=M(),[s,l]=(0,n.useState)(!0),c=(0,r.useRouter)();return(0,n.useEffect)(()=>{let{branch_themes_id:e}=c.query;e&&(l(!0),a(e).finally(()=>l(!1)))},[c.query,a]),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:V().item,children:(0,t.jsx)("div",{className:"container",children:(0,t.jsxs)("div",{className:"row d-flex align-items-center justify-content-center",children:[(0,t.jsxs)("div",{className:"d-flex flex-wrap flex-column col-3 align-items-center",children:[(0,t.jsx)(K.rVC,{className:V().group}),(0,t.jsxs)("div",{className:V().p,children:[e.min_players," - ",e.max_players," 人"]})]}),(0,t.jsxs)("div",{className:"d-flex flex-wrap flex-column align-items-center col-3",children:[(0,t.jsx)(U.fSQ,{className:V().clock}),(0,t.jsxs)("div",{className:V().p,children:[e.theme_time," 分鐘"]})]}),(0,t.jsxs)("div",{className:"d-flex flex-wrap flex-column col-3 align-items-center",children:[(0,t.jsx)(U.q2z,{className:V().clock}),(0,t.jsx)("div",{className:V().p,children:e.difficulty})]}),(0,t.jsxs)("div",{className:"d-flex flex-wrap flex-column col-3 align-items-center",children:[(0,t.jsx)(U.JeS,{className:V().clock}),(0,t.jsx)("div",{className:V().p,children:"12 +"})]})]})})}),(0,t.jsx)("div",{className:V().price,children:(0,t.jsx)("div",{className:"container",children:(0,t.jsxs)("div",{className:"row d-flex align-items-center justify-content-center flex-wrap",children:[(0,t.jsx)("div",{className:"col-3 d-block align-items-center justify-content-center",children:(0,t.jsxs)("div",{className:V().tag,children:["原價",(0,t.jsxs)("div",{className:V().org,children:[e.price," ",(0,t.jsx)("span",{className:V().tag2,children:"元"})]})]})}),(0,t.jsxs)("div",{className:"col-3 d-block align-items-center justify-content-center",children:[(0,t.jsxs)("div",{className:V().tag,children:[e.min_players," 人"]}),(0,t.jsxs)("div",{className:V().tag,children:["$",(0,t.jsx)("span",{className:V().other,children:e.price-150}),"/人"]})]}),(0,t.jsxs)("div",{className:"col-3 d-block align-items-center justify-content-center",children:[(0,t.jsxs)("div",{className:V().tag,children:[e.min_players+1," 人"]}),(0,t.jsxs)("div",{className:V().tag,children:["$",(0,t.jsx)("span",{className:V().other,children:e.price-100}),"/人"]})]}),(0,t.jsxs)("div",{className:"col-3 d-block align-items-center justify-content-center",children:[(0,t.jsxs)("div",{className:V().tag2,children:[e.min_players+2," - ",e.max_players-1,"人"]}),(0,t.jsxs)("div",{className:V().tag2,children:["$",(0,t.jsx)("span",{className:V().other,children:e.price-50}),"/人"]})]})]})})}),(0,t.jsx)("div",{className:V().themeBanner,style:{backgroundImage:"url('/themes-banner/".concat(e.theme_banner,"')")}})]})}var X=s(45250),$=s.n(X),ee=s(62914),ea=s(54425),es=s(11828);function et(){let{themeDetails:e,getThemeDetails:a}=M(),[s,l]=(0,n.useState)(!0),c=(0,r.useRouter)();return(0,n.useEffect)(()=>{let{branch_themes_id:e}=c.query;e&&(l(!0),a(e).finally(()=>l(!1)))},[c.query,a]),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("h2",{className:$().h1,children:[e.theme_name," - ",e.branch_name," "]}),(0,t.jsxs)("div",{className:"container",children:[(0,t.jsx)("hr",{className:$().line}),(0,t.jsxs)("div",{className:"row mt-5 d-flex justify-content-center",children:[(0,t.jsxs)("div",{className:"col-6 col-md-2 d-flex flex-column align-items-center mb-4",children:[(0,t.jsxs)("div",{className:$().step1,children:["Step. 1",(0,t.jsx)("div",{className:$().step1,children:"填寫預約"})]}),(0,t.jsx)(ee.$GO,{className:$().icon}),(0,t.jsx)("span",{className:$().p,children:"選擇場次和遊玩人數"})]}),(0,t.jsx)(es.hjJ,{className:"col-1 d-none d-md-block ".concat($().icon2)}),(0,t.jsxs)("div",{className:"col-6 col-md-2 d-flex flex-column align-items-center mb-4",children:[(0,t.jsxs)("div",{className:$().step1,children:["Step. 2",(0,t.jsx)("div",{className:$().step1,children:"預付訂金"})]}),(0,t.jsx)(ea.GdJ,{className:$().icon}),(0,t.jsx)("span",{className:$().p,children:"填寫付款資料"})]}),(0,t.jsx)(es.hjJ,{className:"col-1 d-none d-md-block ".concat($().icon2)}),(0,t.jsxs)("div",{className:"col-6 col-md-2 d-flex flex-column align-items-center mb-4",children:[(0,t.jsxs)("div",{className:$().step1,children:["Step. 3",(0,t.jsx)("div",{className:$().step1,children:"確認資料"})]}),(0,t.jsx)(O.FJM,{className:$().icon}),(0,t.jsx)("span",{className:$().p,children:"確認預約資訊無誤"})]}),(0,t.jsx)(es.hjJ,{className:"col-1 d-none d-md-block ".concat($().icon2)}),(0,t.jsxs)("div",{className:"col-6 col-md-2 d-flex flex-column align-items-center mb-4",children:[(0,t.jsxs)("div",{className:$().step1,children:["Final",(0,t.jsx)("div",{className:$().step1,children:"預約完成"})]}),(0,t.jsx)("div",{className:$().check}),(0,t.jsx)("span",{className:$().p2,children:"歡迎遊玩密室逃脫"})]})]})]})]})}var en=s(27484),er=s.n(en),el=s(44788),ec=s(62325),ei=s(16075),eo=s(87066);let ed=e=>{let[a,s]=(0,n.useState)(null),[t,r]=(0,n.useState)(!1),[l,c]=(0,n.useState)(null);return(0,n.useEffect)(()=>{let a=eo.Z.CancelToken.source();return(async()=>{if(e){r(!0),c(null);try{let t=await eo.Z.get("".concat(m.ny,"?member_id=").concat(e),{cancelToken:a.token});console.log("User profile response:",t.data),t.data.status&&t.data.rows.length>0?s(t.data.rows[0]):s(null)}catch(e){if(eo.Z.isCancel(e))console.log("Request canceled:",e.message);else{var t;console.error("Error fetching user profile:",(null===(t=e.response)||void 0===t?void 0:t.data)||e.message),c(e)}}finally{r(!1)}}})(),()=>{a.cancel("Component unmounted")}},[e]),{userProfile:a,loading:t,error:l}};var em=s(22956),ep=s(99385),eh=s.n(ep),eu=s(67930),e_=s.n(eu);function ex(e){let a,{name:s="",type:r="text",value:l="",placeholder:c="",disabled:i=!1,inputStyles:o="def",onChange:d=()=>{},onBlur:m=()=>{}}=e,[p,h]=(0,n.useState)(r);return(0,n.useEffect)(()=>{h(r)},[r]),"def"===o&&(a=!1===i?e_().inputDefault:e_().inputDisabled),"line"===o&&(a=!1===i?e_().inputDefaultLine:e_().inputDisabledLine),(0,t.jsx)("div",{className:e_().input,children:(0,t.jsx)("input",{name:s,type:p,value:l,placeholder:c,disabled:i,className:a,onChange:d,onBlur:m,style:{color:"#B99755"}})})}var eg=s(86605),ej=s(42179),ef=s(747),ev=s(83886);let eb="#B99755",ey="#B99755",eN="#757575",eC=(0,ev.Z)({components:{MuiSelect:{styleOverrides:{root:{height:"40px",width:"100%",fontFamily:"Noto Serif JP, serif","& .MuiSelect-select":{padding:"8px 16px",color:eN,'&:not([class*="placeholder"])':{color:ey}},"& .MuiOutlinedInput-notchedOutline":{border:"".concat("2px"," solid ").concat(eb),lineHeight:1,borderRadius:"8px"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"#B99755"},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:"#B99755",boxShadow:"0 0 0 3px ".concat("#efede8")},"& .MuiSelect-icon":{transition:"200ms"}},icon:{color:eN}}},MuiPaper:{styleOverrides:{root:{border:"".concat("2px"," solid ").concat(eb),borderRadius:"8px",boxShadow:"none"}}},MuiList:{styleOverrides:{root:{maxHeight:"300px",overflow:"auto",color:"black"}}},MuiMenuItem:{styleOverrides:{root:{fontFamily:"Noto Serif JP, serif","&.Mui-selected":{backgroundColor:"",color:ey},"&.Mui-selected:hover":{backgroundColor:"",color:ey}}}}}});var eS=s(48234);function eE(e){let{name:a="",value:s="",placeholder:n="",options:r=[],onChange:l=()=>{}}=e;return Array.isArray(r)?(0,t.jsx)(ef.Z,{theme:eC,children:(0,t.jsxs)(ej.Z,{name:a,value:s,onChange:l,IconComponent:eS.Z,displayEmpty:!0,children:[(0,t.jsx)(eg.Z,{value:"",disabled:!0,children:n}),r.map((e,a)=>(0,t.jsx)(eg.Z,{value:e.value,children:e.text},a))]})}):(console.error("options不是陣列，請確認",r),null)}var ek=s(75557),ew=s(43176),eT=s(10879);function eI(e){let{value:a,onChange:s}=e;return(0,t.jsx)(eT.Z,{placeholder:"備註(如有12以下孩童、孕婦、行動不便者請在此告知)",minRows:5,value:a,onChange:s,sx:{color:"#B99755",border:"2px solid #B99755",background:"#222222",fontFamily:"Noto Serif JP",borderRadius:"10px","&:focus-within":{borderColor:"#B99755",backgroundColor:"white",color:"#222222"},"&:focus-within::before":{boxShadow:"0 0 0 0.25rem #B99755"}}})}var eF=s(69271),eB=s(72984),eL=s(3859);let eD=(0,ev.Z)({components:{MuiRadio:{styleOverrides:{root:{"&:hover":{backgroundColor:"unset"}}}},MuiTypography:{styleOverrides:{root:{fontFamily:"Noto Serif JP"}}},MuiSvgIcon:{styleOverrides:{root:{'&[data-testid="RadioButtonUncheckedIcon"]':{fill:"#B99755"},'&[data-testid="RadioButtonCheckedIcon"]':{fill:"#B99755"}}}}}});function eM(e){let{radios:a=[],name:s="",value:r="",disabled:l=!1,onChange:c=()=>{}}=e,[i,o]=(0,n.useState)(!1);return(0,n.useEffect)(()=>{if(!Array.isArray(a)){console.error("提供的radios不是陣列，請確認 >>",a);return}o(!0)},[a]),(0,t.jsx)(t.Fragment,{children:i?(0,t.jsx)(ef.Z,{theme:eD,children:(0,t.jsx)(Z.Z,{height:40,display:"flex",alignItems:"center",children:(0,t.jsx)(eF.Z,{row:!0,name:s,value:r,onChange:c,children:a.map((e,a)=>(0,t.jsx)(eB.Z,{value:e.value,control:(0,t.jsx)(eL.Z,{}),label:e.label,disabled:l},a))})})}):null})}var eP=s(1604);let eR=eP.z.object({name:eP.z.string().min(2,{message:"請填寫姓名，長度為 2 ~ 20 個字元"}).max(20,{message:"請填寫姓名，長度為 2 ~ 20 個字元"}),mobile_phone:eP.z.string({required_error:"請填寫手機號碼"}).min(1,{message:"請填寫手機號碼"}).refine(e=>/^09\d{8}$/.test(e),{message:"請填寫正確的手機號碼格式"}),date:eP.z.string().refine(e=>/^\d{4}-\d{2}-\d{2}$/.test(e)&&!isNaN(Date.parse(e)),{message:"無效的日期格式，請重新選擇"}),timeSlot:eP.z.string().nonempty({message:"請選擇場次"}),people:eP.z.string().nonempty({message:"請選擇人數"}),discount:eP.z.string().nonempty({message:"請選擇優惠項目"})});function eA(){var e;let{dateSessionsStatus:a}=(0,em.k)(),{selectedDate:s}=(0,n.useContext)(el.K),[l,c]=(0,n.useState)(""),[i,o]=(0,n.useState)(""),[d,m]=(0,n.useState)(""),[p,h]=(0,n.useState)(""),[u,_]=(0,n.useState)(!1),[x,g]=(0,n.useState)({}),[j,f]=(0,n.useState)(""),[v,b]=(0,n.useState)(""),[y,N]=(0,n.useState)(""),[C,S]=(0,n.useState)(""),{themeDetails:E,getThemeDetails:k,updateAvailableCoupons:w}=M(),[T,I]=(0,n.useState)(!0),F=(0,r.useRouter)(),{loginFormSwitch:B}=(0,ec.NK)(),{auth:L}=(0,ei.aC)(),[D,P]=(0,n.useState)(!1),{userProfile:R,loading:A}=ed(null==L?void 0:L.id),[Z,H]=(0,n.useState)(!1);(0,n.useEffect)(()=>{(null==L?void 0:L.id)&&R?H(!0):(H(!1),P(!1))},[null==L?void 0:L.id,R]),(0,n.useEffect)(()=>{let{branch_themes_id:e}=F.query;e&&(null==L?void 0:L.id)&&(I(!0),k(e,L.id).then(()=>{I(!1),z()}).catch(e=>{console.error("Error fetching theme details:",e),I(!1)}))},[F.query.branch_themes_id,null==L?void 0:L.id,k]),(0,n.useEffect)(()=>{z()},[s]);let z=()=>{s?(m("".concat(s.year,"-").concat(String(s.month+1).padStart(2,"0"),"-").concat(String(s.day).padStart(2,"0"))),g(e=>({...e,date:void 0}))):m("")};(0,n.useEffect)(()=>{z()},[s]);let q=e=>{g(a=>({...a,[e]:void 0}))},W=(e,a)=>{let s=e.target.value;switch(a){case"timeSlot":f(s.toString());break;case"people":b(s.toString());break;case"discount":N(s)}q(a)},Y=()=>{_(!1),g(e=>({...e,readNotice:void 0}))};return(0,t.jsxs)("div",{className:eh().reservationrBg,children:[(0,t.jsxs)("div",{className:eh().form,children:[(0,t.jsxs)("div",{className:eh().title,children:[(0,t.jsx)(O.ycZ,{}),"  請先 登入/註冊會員 再預約"]}),(0,t.jsxs)("form",{onSubmit:e=>{let a;if(e.preventDefault(),!L.id){B("Login");return}let s={user_id:L.id,branch_themes_id:E.branch_themes_id,reservation_date:d,session_id:parseInt(j),participants:parseInt(v),coupon_name:y,remark:C},t=eR.shape.name.safeParse(l),n=eR.shape.mobile_phone.safeParse(i.toString()),r=eR.shape.timeSlot.safeParse(j),c=eR.shape.people.safeParse(v.toString()),o=eR.shape.discount.safeParse(y);a=d?eR.shape.date.safeParse(d):{success:!1,error:{format:()=>({_errors:["請選取預約日期"]})}};let m=p?{success:!0}:{success:!1,error:{format:()=>({_errors:["請閱讀並同意注意事项"]})}},h={};t.success||(h.name=t.error.format()),n.success||(h.mobile_phone=n.error.format()),a.success||(h.date=a.error.format()),r.success||(h.timeSlot=r.error.format()),c.success||(h.people=c.error.format()),o.success||(h.discount=o.error.format()),m.success||(h.readNotice=m.error.format()),Object.keys(h).length>0?g(h):(g({}),fetch("http://localhost:3001/themes/api/reservations",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}).then(e=>{if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));return e.json()}).then(e=>{if(console.log("Reservation response:",e),e.success){let a=e.reservation_id,t=E.sessions.find(e=>e.sessions_id.toString()===j);return N(""),w(E.branch_themes_id,L.id).then(n=>{console.log("Updated available coupons:",n),F.push({pathname:"/themes/checkout",query:{...s,reservation_id:a,deposit:e.deposit,name:l,mobile_phone:i,timeSlot:j,sessionTime:t?"".concat(t.start_time," - ").concat(t.end_time):"",people:v,discount:y,themeName:e.theme_name,branchName:e.branch_name,themeImage:E.theme_img,remark:C}})})}throw Error(e.message||"預約創建失敗")}).catch(e=>{console.error("預約提交失敗:",e),alert("預約提交失敗，請稍後再試。錯誤詳情："+e.message)}))},children:[(0,t.jsxs)("div",{className:eh().p,children:[(0,t.jsx)(ex,{className:eh().p,name:"name",type:"text",value:l,placeholder:"姓名",onChange:e=>{let a=e.target.value;c(a);let s=eR.safeParse({name:a});s.success?g(e=>({...e,name:void 0})):g(e=>({...e,name:s.error.format().name}))}}),x.name&&x.name._errors&&x.name._errors.map((e,a)=>(0,t.jsx)("span",{className:eh().error,children:e},a))]}),(0,t.jsxs)("div",{className:eh().p,children:[(0,t.jsx)(ex,{className:eh().p,name:"mobile_phone",type:"text",value:i,placeholder:"手機",onChange:e=>{let a=e.target.value;o(a);let s=eR.safeParse({mobile_phone:a});s.success?g(e=>({...e,mobile_phone:void 0})):g(e=>({...e,mobile_phone:s.error.format().mobile_phone}))}}),x.mobile_phone&&x.mobile_phone._errors&&x.mobile_phone._errors.map((e,a)=>(0,t.jsx)("span",{className:eh().error,children:e},a))]}),Z&&(0,t.jsx)(ek.Z,{children:(0,t.jsx)(ew.Z,{label:"同會員資料",sx:{color:"#B99755",mt:3},checked:D,onChange:e=>{let a=e.target.checked;P(a),a&&R?(c(R.name||R.nickname||""),o(R.mobile_phone||""),g(e=>({...e,name:void 0,mobile_phone:void 0}))):(c(""),o(""))}})}),(0,t.jsxs)("div",{className:eh().p,children:[(0,t.jsx)(ex,{className:eh().p,name:"date",type:"text",value:d,placeholder:"預約日期(請點選日曆)",readOnly:!0}),x.date&&x.date._errors&&x.date._errors.map((e,a)=>(0,t.jsx)("span",{className:eh().error,children:e},a))]}),(0,t.jsx)("div",{className:eh().p,children:(0,t.jsx)("div",{className:eh().p,children:(0,t.jsxs)("div",{className:eh().p,children:[(0,t.jsx)(eE,{name:"timeSlot",value:j,placeholder:"選擇場次",options:(null==E?void 0:null===(e=E.sessions)||void 0===e?void 0:e.filter(e=>!a.some(a=>a.sessions_id===e.sessions_id&&1===a.is_booked)).map(e=>({text:"".concat(e.start_time," - ").concat(e.end_time),value:e.sessions_id})))||[],onChange:e=>W(e,"timeSlot")}),x.timeSlot&&x.timeSlot._errors&&x.timeSlot._errors.map((e,a)=>(0,t.jsx)("span",{className:eh().error,children:e},a))]})})}),(0,t.jsxs)("div",{className:eh().p,children:[(0,t.jsx)(eE,{name:"people",value:v,placeholder:"請選擇人數",options:Array.from({length:(null==E?void 0:E.max_players)-(null==E?void 0:E.min_players)+1},(e,a)=>({text:"".concat((null==E?void 0:E.min_players)+a," 人"),value:(null==E?void 0:E.min_players)+a})),onChange:e=>W(e,"people")}),x.people&&x.people._errors&&x.people._errors.map((e,a)=>(0,t.jsx)("span",{className:eh().error,children:e},a))]}),(0,t.jsx)("div",{className:eh().p,children:(0,t.jsx)("div",{className:eh().p,children:(0,t.jsx)("div",{className:eh().p,children:(0,t.jsx)(eE,{name:"discount",value:y,placeholder:"優惠項目",options:[{text:"無",value:"無"},...Array.isArray(E.available_coupons)&&E.available_coupons.length>0?E.available_coupons.map(e=>({text:"".concat(e.coupon_name," ").concat(e.discount_percentage?"".concat(e.discount_percentage,"折"):"".concat(e.discount_amount,"元")),value:e.coupon_name})):[]],onChange:e=>W(e,"discount")})})})}),(0,t.jsx)("div",{className:eh().p,children:(0,t.jsx)(eI,{value:C,onChange:e=>S(e.target.value)})}),(0,t.jsxs)("div",{className:eh().p,children:[(0,t.jsx)(eM,{radios:[{value:"check",label:"請閱讀注意事項"}],name:"readNotice",value:p,onChange:e=>{h(e.target.value),_(!0)}}),x.readNotice&&x.readNotice._errors&&x.readNotice._errors.map((e,a)=>(0,t.jsx)("span",{className:eh().error,children:e},a))]}),(0,t.jsx)("div",{className:eh().reservation,children:(0,t.jsx)("button",{className:eh().booking,type:"submit",children:"我要預約"})})]})]}),(0,t.jsx)(G,{open:u,onClose:Y,modalTitle:"注意事項",modalBody:(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:eh().p1,children:"1. 活動採包場制，不協助並團，預約須達「遊戲最低人數」。"}),(0,t.jsx)("p",{className:eh().p1,children:"2. 變更或取消預訂日期，請於預約日前一日來電通知。臨時取消將會影響您下次預約的優先權利。"}),(0,t.jsx)("p",{className:eh().p1,children:"3. 在遊戲人數範圍內可以臨時追加人數，不需與客服聯繫，當日將以現場人數收費。遇天災或不可抗力因素取消或變更場次，以網站公告為準。"}),(0,t.jsxs)("p",{className:eh().p1,children:["4. 請「準時到場」集合報到，現場以"," ",(0,t.jsx)("span",{className:eh().p3,children:"現金收費"})," ","並進行事前說明。超過表定時間未報到入場，即取消場次，開放給現場玩家預約。"]}),(0,t.jsx)("p",{className:eh().p1,children:"5. 活動流程包含事前說明、進行密室逃脫、遊戲後故事解說（無全程謎題講解）。"}),(0,t.jsxs)("p",{className:eh().p1,children:["6. 遊玩人數低於建議人數時難度較高，不足開場人數時將導致活動無法進行。本遊戲因場景及遊戲設計，"," ",(0,t.jsx)("span",{className:eh().p3,children:"未滿12歲、孕婦及行動不便者不得入場"}),"。"]}),(0,t.jsx)("p",{className:eh().p1,children:"8. 如因年齡未達遊戲主題限制，本工作室有權拒絕玩家入場，並不得將未成年孩童托管在場館內。如有特殊需求（嬰兒車、寵物等），請先來電詢問。"}),(0,t.jsx)("p",{className:eh().p1,children:"9. 遊戲期間請勿飲食、攝影及錄音。"}),(0,t.jsx)("p",{className:eh().p1,children:"10. 場內設置各項活動機關，請「穿著方便活動的衣物」。"}),(0,t.jsx)("p",{className:eh().p3,children:"遊戲過程中如有毀損道具及場景之行為，造成本工作室損失，將提出求償。（包含道具維修、場景修復、營業損失之費用等等）。"})]}),buttonLabel:"我已閱讀",onButtonClick:Y})]})}var eO=s(58594),eZ=s.n(eO),eH=e=>{let{branch_themes_id:a}=e,{setDateSessionsStatus:s}=(0,em.k)(),{id:l}=(0,r.useRouter)().query,[c,i]=(0,n.useState)(er()()),[o,d]=(0,n.useState)([]),[m,p]=(0,n.useState)(null),[h,u]=(0,n.useState)(c.month()),[_,x]=(0,n.useState)(c.year()),{updateSelectedDate:g}=(0,n.useContext)(el.K),[j,f]=(0,n.useState)({}),v=e=>{let a=er()(),s=a.add(3,"month");return e.isAfter(a,"day")&&e.isBefore(s,"day")},b=async(e,s)=>{if(a)try{let t=await eo.Z.get("http://localhost:3001/themes/calendar",{params:{year:e,month:s,branch_themes_id:a}});f(t.data)}catch(e){console.error("Error fetching calendar data:",e)}};(0,n.useEffect)(()=>{console.log("Calendar component:",{year:_,month:h,branch_themes_id:a}),a&&b(_,h+1)},[_,h,a]),(0,n.useEffect)(()=>{a&&b(c.year(),c.month()+1)},[c,a]),(0,n.useEffect)(()=>{(()=>{let e=c.startOf("month"),a=c.endOf("month"),s=e.day();a.day();let t=[];er()();for(let a=s;a>0;a--)t.push({day:e.subtract(a,"day").date(),currentMonth:!1,status:"disabled"});for(let e=1;e<=a.date();e++){let a=er()("".concat(_,"-").concat(h+1,"-").concat(e)),s=j[a.format("YYYY-MM-DD")]||{},n=v(a),r=a.isBefore(er()(),"day")||a.isSame(er()(),"day");t.push({day:e,currentMonth:!0,status:r?"disabled":n?s.status||"open":"disabled",clickable:n&&!r&&"full"!==s.status})}let n=(7-(s+a.date())%7)%7;for(let e=1;e<=n;e++)t.push({day:e,currentMonth:!1,status:"disabled"});d(t)})()},[c,h,_,j]);let y=()=>{let e=c.subtract(1,"month");i(e),u(e.month()),x(e.year())},N=()=>{let e=c.add(1,"month");i(e),u(e.month()),x(e.year())},C=(e,a)=>{("Enter"===e.key||" "===e.key)&&a()},S=e=>{"disabled"!==e.status&&(p(e),g({day:e.day,month:c.month(),year:c.year()}),E("".concat(c.year(),"-").concat(String(c.month()+1).padStart(2,"0"),"-").concat(String(e.day).padStart(2,"0")),a))},E=async e=>{try{let t=await eo.Z.get("http://localhost:3001/themes/sessions-status",{params:{date:e,branch_themes_id:a}});s(t.data)}catch(e){console.error("Error fetching sessions status:",e)}},k=(e,a)=>{let s=[eZ().date];return("prev-month"===e.status||"next-month"===e.status)&&s.push(eZ().otherMonth),"open"===e.status&&s.push(eZ().open),"partial"===e.status&&s.push(eZ().partial),"full"===e.status&&s.push(eZ().full),"disabled"===e.status&&s.push(eZ().disabled),e.clickable||s.push(eZ().notClickable),e.currentMonth&&e.day===er()().date()&&c.month()===er()().month()&&c.year()===er()().year()&&s.push(eZ().currentDay),m&&m.day===e.day&&e.currentMonth&&s.push(eZ().selected),(0,t.jsx)("td",{className:s.join(" "),children:(0,t.jsx)("div",{onClick:()=>e.clickable&&S(e),onKeyPress:a=>e.clickable&&C(a,()=>S(e)),role:"button",tabIndex:e.clickable?"0":"-1",className:eZ().dateContent,children:e.day})},a)};return(0,t.jsx)("div",{className:"container-fluid container-md",children:(0,t.jsxs)("div",{className:"row d-flex justify-content-evenly",children:[(0,t.jsx)("div",{className:eZ().calendarBg,children:(0,t.jsxs)("div",{className:eZ().calendar,children:[(0,t.jsxs)("div",{className:"d-flex justify-content-evenly align-items-center mb-3",children:[(0,t.jsx)("div",{onClick:y,onKeyPress:e=>C(e,y),role:"button",tabIndex:"0",children:(0,t.jsx)(es.EY6,{className:eZ().icon})}),(0,t.jsx)("div",{children:(0,t.jsx)("h4",{children:er()(new Date(_,h)).format("MMMM YYYY")})}),(0,t.jsx)("div",{onClick:N,onKeyPress:e=>C(e,N),role:"button",tabIndex:"0",children:(0,t.jsx)(es.kWz,{className:eZ().icon})})]}),(0,t.jsxs)("table",{className:eZ().table,children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{children:"Su"}),(0,t.jsx)("td",{children:"Mo"}),(0,t.jsx)("td",{children:"Tu"}),(0,t.jsx)("td",{children:"We"}),(0,t.jsx)("td",{children:"Th"}),(0,t.jsx)("td",{children:"Fr"}),(0,t.jsx)("td",{children:"Sa"})]})}),(0,t.jsx)("tbody",{children:(()=>{let e=[],a=[];return o.forEach((s,n)=>{a.push(k(s,n)),7===a.length&&(e.push((0,t.jsx)("tr",{children:a},n)),a=[])}),a.length>0&&e.push((0,t.jsx)("tr",{children:a},a.length)),e})()})]}),(0,t.jsxs)("div",{className:"mt-3 d-flex flex-row align-items-center justify-content-end mb-4",children:[(0,t.jsxs)("div",{className:"d-flex align-items-center justify-content-end mb-2 mb-md-0",children:[(0,t.jsx)(O.gbA,{className:eZ().icon2}),(0,t.jsx)("span",{children:"場次已額滿"})]}),(0,t.jsxs)("div",{className:"d-flex align-items-center justify-content-end mb-2 mb-md-0",children:[(0,t.jsx)(O.gbA,{className:eZ().icon3}),(0,t.jsx)("span",{children:"剩部分場次"})]}),(0,t.jsxs)("div",{className:"d-flex align-items-center justify-content-end mb-2 mb-md-0",children:[(0,t.jsx)(O.gbA,{className:eZ().icon4}),(0,t.jsx)("span",{children:"開放預約"})]})]}),(0,t.jsx)("hr",{className:eZ().hr}),(0,t.jsxs)("div",{className:"d-flex flex-column flex-md-row justify-content-between",children:[(0,t.jsxs)("div",{className:"".concat(eZ().info," mb-3 mb-md-0"),children:[(0,t.jsx)("div",{className:"mb-3",children:"預約當日場次請來電 (･∀･)"}),(0,t.jsx)("div",{children:"For international travelers, "}),(0,t.jsx)("div",{children:"please send a direct message"}),(0,t.jsx)("div",{children:"to our FB or Instagram."})]}),(0,t.jsxs)("div",{className:"d-flex justify-content-end align-items-end",children:[(0,t.jsx)(O.Am9,{className:eZ().icon5}),(0,t.jsx)(O.Zf_,{className:eZ().icon5})]})]})]})}),(0,t.jsx)(eA,{id:l})]})})};function ez(){let e=(0,r.useRouter)(),{themeDetails:a,getThemeDetails:s}=M(),[c,i]=n.useState(""),o=e.query.branch_themes_id;return(n.useEffect(()=>{e.isReady&&o&&s(o)},[e.isReady,o,s]),n.useEffect(()=>{a&&i(a.theme_name)},[a]),a)?(0,t.jsxs)(l.Z,{pageName:"themesDetails",title:"密室逃脫",background:"dark",children:[(0,t.jsx)(L,{Banner:(0,t.jsx)(Y,{}),Item:(0,t.jsx)(Q,{}),Step:(0,t.jsx)(et,{}),Calendar:(0,t.jsx)(eH,{branch_themes_id:o})}),(0,t.jsx)("div",{className:"container",children:(0,t.jsx)("div",{className:"row"})})]}):(0,t.jsx)("div",{children:" "})}var eq=()=>(0,t.jsx)(P,{children:(0,t.jsx)(ez,{})})},35122:function(e){e.exports={"card-02":"cards_card-02__EyA3r",bookingButton:"cards_bookingButton__Di_bq",arrow:"cards_arrow__QFNi0"}},67930:function(e){e.exports={inputDefault:"input01_inputDefault__S96qa",inputDefaultLine:"input01_inputDefaultLine__ilI_Z",inputDisabled:"input01_inputDisabled__xtchv",inputDisabledLine:"input01_inputDisabledLine__TmdRb"}},40756:function(e){e.exports={"top-btn":"details_top-btn__TioRx",visible:"details_visible__OBmvO",default:"details_default__ihPVU",hover:"details_hover__esORE"}},2051:function(e){e.exports={modalBox:"basic-modal_modalBox__ZRwAD",modalHeader:"basic-modal_modalHeader__aSEzc",modalContent:"basic-modal_modalContent__Jl87x",modalFooter:"basic-modal_modalFooter__46mdg",buttonContainer:"basic-modal_buttonContainer__vf3r7"}},90167:function(e){e.exports={item:"banner_item__PGojN",h1:"banner_h1__0gWNz",p:"banner_p__50rxo",hr:"banner_hr__KUAxA",comment:"banner_comment__rFhRq",section:"banner_section__NzN49",star:"banner_star__waDGF",span:"banner_span__GrEWh",warning:"banner_warning__hn0rV",title:"banner_title__z2uED",musicPromptOverlay:"banner_musicPromptOverlay__3x95Y",musicPrompt:"banner_musicPrompt__NWe3_",musicPromptButtons:"banner_musicPromptButtons__nPjbM",acceptButton:"banner_acceptButton__ZAQyp",declineButton:"banner_declineButton__8y_6B",play:"banner_play__8hRpn",playerWrapper:"banner_playerWrapper__TJSwi",soundBar:"banner_soundBar__rdJwI",sound:"banner_sound__6Zvni",playerButton:"banner_playerButton__QRwqG",soundBarsContainer:"banner_soundBarsContainer____kyd",autoplayMessage:"banner_autoplayMessage__4tZFg",p3:"banner_p3__yS4g3",p1:"banner_p1__T0aVi"}},58594:function(e){e.exports={calendarBg:"calendar_calendarBg__jtSq5",date:"calendar_date__jYfw2",selected:"calendar_selected__b_QWT",hr:"calendar_hr__RWxvn",h2:"calendar_h2__uUijU",h3:"calendar_h3__578xI",table:"calendar_table__z2VH9",calendar:"calendar_calendar___jP72",icon:"calendar_icon__dkdQD",prevMonth:"calendar_prevMonth__28zQY",nextMonth:"calendar_nextMonth__WUFF_",disabled:"calendar_disabled__pBfcY",open:"calendar_open__rYgKL",partial:"calendar_partial__L62__",notClickable:"calendar_notClickable__k_U2R",full:"calendar_full__oX1vL",event:"calendar_event__JrHlT",currentDay:"calendar_currentDay__DL2Eg","btn-prev":"calendar_btn-prev__F248d","btn-next":"calendar_btn-next__nzJlE",icon2:"calendar_icon2__YVe2t",icon3:"calendar_icon3__hEy8x",icon4:"calendar_icon4__Nn3KT",info:"calendar_info__zVfAk",icon5:"calendar_icon5__3V8Vv"}},70009:function(e){e.exports={title:"game_title__runql",title2:"game_title2__OO8Wb",gameContent:"game_gameContent__AyknO",level:"game_level__2qs2p",cardGrid:"game_cardGrid__Ixhzr",card:"game_card__ykXmc",cardInner:"game_cardInner__2zlBv",cardFlipped:"game_cardFlipped__et4Cg",cardFace:"game_cardFace__woj77",cardFront:"game_cardFront__ou5km",cardBack:"game_cardBack__qIiPm",p:"game_p__TeCKR",p2:"game_p2__CUMuH",riddleContainer:"game_riddleContainer__OzoRt",riddle:"game_riddle__Fdw4S",introScreen:"game_introScreen__K_5ME",levelCompleteScreen:"game_levelCompleteScreen__5l18K",gameCompletedScreen:"game_gameCompletedScreen__SBIbr",introImage:"game_introImage__iDd9L",levelCompleteImage:"game_levelCompleteImage__8AnQY",gameCompletedImage:"game_gameCompletedImage__q_Qem",startButton:"game_startButton__bCr3K",nextLevelButton:"game_nextLevelButton__675K_",message:"game_message__1oSAe",objectToFindContainer:"game_objectToFindContainer__NXe_r",objectToFindImage:"game_objectToFindImage__0oP_l",imageComparisonContainer:"game_imageComparisonContainer__0Lqji",imageWrapper:"game_imageWrapper__XG10U",image:"game_image__01sNo",difference:"game_difference__qA6FZ",found:"game_found__CNbpn",tabsContainer:"game_tabsContainer__ebSzx",tabs:"game_tabs__UhIEJ",tabButton:"game_tabButton__LEdrD",activeTab:"game_activeTab___2kST",tabDivider:"game_tabDivider__m0nWL"}},37887:function(e){e.exports={item:"item_item__w1aAJ",price:"item_price__urlWM",group:"item_group__lu8UE",clock:"item_clock__NYzIr",p:"item_p__bGc1k",tag:"item_tag__D9Boh",tag2:"item_tag2__Eztzu",org:"item_org__r1e9K",other:"item_other__e2WSD",themeBanner:"item_themeBanner__5uqAe"}},29100:function(e){e.exports={h1:"details_h1__FHRf7",line:"details_line___osS1",step:"details_step__L5Fx2",icon:"details_icon__SoIER",icon2:"details_icon2___U_fa",check:"details_check__Lrmq6",p:"details_p___lHoN",p2:"details_p2__AfFuW"}},99385:function(e){e.exports={reservationrBg:"reservation_reservationrBg__plcIg",form:"reservation_form__WJ2XH",p:"reservation_p__WoDgp",booking:"reservation_booking__YQ0W_",title:"reservation_title__U7xJz",error:"reservation_error___1w4Q",reservation:"reservation_reservation__LwEyY",p3:"reservation_p3__500xe",p1:"reservation_p1__hcIZp"}},45250:function(e){e.exports={h1:"step_h1__q3Pad",line:"step_line__NS_6l",step1:"step_step1__zkWbo",step2:"step_step2___Vr_Y",price:"step_price__wOkN8",icon:"step_icon__Z6Gdg",icon2:"step_icon2__HutGA",icon3:"step_icon3__WcqP2",check:"step_check__dlW6c",p:"step_p__TcTPg",p2:"step_p2__JSCD_",p3:"step_p3__ScOtF",step:"step_step__KXd4F","col-6":"step_col-6__gpp_M",row:"step_row__HOdd5","col-5":"step_col-5__YrtFd","d-md-none":"step_d-md-none__znkT3",largeIcon:"step_largeIcon__IRHOH"}}},function(e){e.O(0,[5970,4838,9317,4396,6660,509,2961,4321,4738,3662,648,959,6497,2179,9087,7601,9180,3483,2888,9774,179],function(){return e(e.s=50204)}),_N_E=e.O()}]);