(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5023],{13777:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/teams/[team_id]",function(){return a(54662)}])},56733:function(e,t,a){"use strict";a.d(t,{iS:function(){return r},l2:function(){return i},mr:function(){return l},o0:function(){return o},wZ:function(){return c}});var s=a(80008),n=a.n(s);let i=e=>n()(e).tz("Asia/Taipei").format("YYYY年MM月DD日"),r=e=>n()(e).tz("Asia/Taipei").format("YYYY/MM/DD"),o=e=>n()(e).tz("Asia/Taipei").format("YYYY年MM月DD日 HH:mm"),l=e=>n()(e,"HH:mm:ss").format("A hh:mm"),c=e=>n()(e,"HH:mm:ss").format("HH:mm")},54662:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return W}});var s=a(85893),n=a(67294),i=a(41664),r=a.n(i),o=a(11163),l=a(16075),c=a(45747),d=a(97928),m=a(53483),h=a(25675),x=a.n(h),_=a(1030),u=a(56733),p=e=>{let{avatar:t,nickName:a,height:n=40,width:i=40}=e;return(0,s.jsx)(x(),{src:t?"".concat(c.UW,"/avatar/").concat(t):"/default-avatar.png",height:n,width:i,alt:"".concat(a," avatar"),style:{borderRadius:"50%"}})},j=a(76214),g=a.n(j),f=a(67614),b=e=>{let{teamData:t,memberCount:a}=e;return(0,s.jsxs)("div",{className:"row",children:[(0,s.jsxs)("div",{className:"col-12 col-md-4 px-3 pb-5 ".concat(g().teamlistblock1),children:[(0,s.jsx)("div",{className:g().teamTitle,children:(0,s.jsx)("h3",{children:(0,s.jsx)(r(),{href:"/themes/themes-details/".concat(t.theme_id),children:t.theme_name})})}),(0,s.jsx)(f.Z,{title:t.theme_desc,children:(0,s.jsx)("div",{className:"teamPhoto",children:(0,s.jsx)(_.Z,{ratio:"375/240",children:(0,s.jsx)(x(),{src:"/themes-main/".concat(t.theme_img),alt:"",width:"579",height:"415"})})})})]}),(0,s.jsxs)("div",{className:"col-12 col-md-8 px-5",children:[(0,s.jsxs)("h5",{className:"pt-3",children:["團隊名：",t.team_title]}),(0,s.jsxs)("div",{className:"py-3",children:["行程時間：",(0,u.l2)(t.reservation_date)," ",(0,u.mr)(t.start_time),(0,s.jsx)("br",{}),"冒險長度：",t.theme_Time," 分鐘",(0,s.jsx)("br",{}),"地區：",t.branch_name,(0,s.jsx)("br",{}),"申請人數/人數上限：",a," / ",t.team_limit]}),(0,s.jsx)("hr",{}),(0,s.jsxs)("div",{style:{fontSize:"24px",paddingTop:"2px",paddingBottom:"5px"},children:[(0,s.jsx)(p,{avatar:t.avatar,nickName:t.nick_name}),(0,s.jsx)("span",{style:{marginLeft:"15px"},children:t.nick_name})]}),(0,s.jsxs)("div",{style:{fontSize:"16px"},children:[" ","團長的話：",(0,s.jsx)("br",{}),t.team_note]})]})]})},y=a(41869),v=a(59154),w=a(98163);function S(e){let{modalTitle:t="Modal Title",open:a,onClose:i,modalBody:r,modalBody2:o,buttonLabel:l,buttonLabel2:c,onButtonClick:d}=e,[m,h]=(0,n.useState)(1),[x,_]=(0,n.useState)(r),u=(0,n.useCallback)(()=>{1===m?(_(o),h(2)):(d(),i())},[m,o,c,i]);return(0,s.jsx)(v.Z,{open:a,onClose:i,children:(0,s.jsxs)(y.Z,{sx:k,children:[(0,s.jsx)("h6",{style:C,children:t}),(0,s.jsx)("hr",{}),(0,s.jsx)("div",{style:N,children:x}),(0,s.jsx)("div",{style:{display:"flex",justifyContent:"center",marginTop:"1rem"},children:(0,s.jsx)(w.Z,{sx:T,variant:"contained",onClick:u,children:1===m?l:c})})]})})}let k={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",bgcolor:"#222222",borderRadius:"1rem",boxShadow:"var(--card-shadow)",padding:"1.5rem",border:"1px solid #B99755",color:"#B99755"},C={marginBottom:"1.5rem",textAlign:"center"},N={maxHeight:"500px",overflowY:"auto",lineHeight:"40px"},T={border:"1px solid black",fontFamily:"Noto Serif JP",fontSize:"16px",borderRadius:"30px",backgroundColor:"#B99755",color:"white",padding:"10px 30px",margin:"12px 24px","&:hover":{backgroundColor:"white",color:"#B99755",boxShadow:"none"},boxShadow:"none"},B={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",bgcolor:"#222222",borderRadius:"1rem",boxShadow:"var(--card-shadow)",padding:"2.5rem",color:"#B99755"},F={marginBottom:"1.5rem",textAlign:"center"},D={maxHeight:"500px",overflowY:"auto",lineHeight:"40px"},R={border:"1px solid black",fontFamily:"Noto Serif JP",fontSize:"16px",borderRadius:"30px",backgroundColor:"#B99755",color:"white",padding:"10px 30px","&:hover":{backgroundColor:"white",color:"#B99755",boxShadow:"none"},boxShadow:"none"};var A=e=>{let t,a,{modalTitle:n="Modal Title",modalBody:i,open:r,onClose:o,team_id:l,TeamReady:m,memberData:h=[],refreshTeamData:x}=e,{openSnackbar:_}=(0,d.Ds)(),u=async()=>{let e=h.map(e=>({no:e.no,m_status:e.m_status}));try{(await fetch(c.rH,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).ok?_("已更新","success"):_("未進行修改","error")}catch(e){console.error("提交資料時發生錯誤:",e)}},p=async()=>{try{let e=await fetch(c.QS,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({team_id:l})});(await e.json()).success?(_("團隊已成立","success"),x()):_("團隊成立失敗","error")}catch(e){console.error("提交資料時發生錯誤:",e)}};return(0,s.jsx)(v.Z,{open:r,onClose:o,children:(0,s.jsxs)(y.Z,{sx:{...B,width:"500px"},children:[(0,s.jsx)("h6",{style:F,children:n}),(0,s.jsx)("hr",{}),(0,s.jsx)("div",{style:D,children:i}),(0,s.jsx)("div",{style:{textAlign:"center"},children:(t={},a="","ready"===m?a="人數達標，要成團了嗎？":"over"===m&&(a="人數超過上限，請重新設定",t={color:"red"}),(0,s.jsx)("span",{style:t,children:a}))}),(0,s.jsx)("div",{style:{display:"flex",justifyContent:"center",marginTop:"1rem"},children:(0,s.jsx)(w.Z,{style:R,variant:"contained",color:"primary",onClick:()=>{if("ready"===m)u(),p();else if("going"===m)u();else if("over"===m)return;o()},children:"ready"===m?"確認成團":"over"===m?"重新設定":"確認"})})]})})},M=a(3859),Y=a(72984),P=a(69271),H=a(89262);let Z=(0,H.ZP)(M.Z)(e=>{let{theme:t}=e;return{"&.Mui-checked":{backgroundColor:t.palette.common.black,padding:"5px",color:"#FFF"},"&":{borderRadius:"50%",padding:"5px"},"& .MuiSvgIcon-root":{fontSize:40,color:"#0000"}}}),E=(0,H.ZP)(Y.Z)(e=>{let{theme:t,selected:a}=e;return{"&.MuiRadioGroup-root":{justifyContent:"center"},"& .MuiTypography-root":{position:"relative",padding:"10px 20px",border:"#B99755 1px solid",borderRadius:"1"===a?"50% 0 0 50%":"0 50% 50% 0"},"& .MuiRadio-root.Mui-checked":{color:t.palette.common.white,backgroundColor:"#b9975582"},"& .MuiRadio-root":{right:"-55px",width:"55px",borderRadius:"1"===a?"50% 0 0 50%":"0 50% 50% 0",color:t.palette.common.white}}});var L=function(e){let{member:t,handleRadioChange:a}=e;return(0,s.jsxs)(P.Z,{row:!0,"aria-labelledby":"radio-buttons-group-label",name:"radio-".concat(t.no),value:1===t.m_status?"1":"0",onChange:e=>a(t.no,e.target.value),children:[(0,s.jsx)(E,{value:"1",control:(0,s.jsx)(Z,{}),label:"Y",selected:"1"}),(0,s.jsx)(E,{value:"0",control:(0,s.jsx)(Z,{}),label:"N",selected:"0"})]})},I=e=>{let{team_id:t,team_limit:a=0,onMemberCountChange:i,onStatusChange:r,onMemberDataChange:o}=e,[l,d]=(0,n.useState)([]),[m,h]=(0,n.useState)(0),x=async e=>{let t=c.w4+e;try{let e=await fetch(t),a=await e.json();if(a.success){d(a.data),i(a.data.length);let e=a.data.filter(e=>1===e.m_status).length;h(e)}}catch(e){}};(0,n.useEffect)(()=>{t&&x(t)},[t]),(0,n.useEffect)(()=>{let e;i(m,a),m<a?(e="going",r("going")):m===a?(e="ready",r("ready")):(e="over",r("over")),i(e),o(l)},[m,a,i,o]);let _=(e,t)=>{let a=parseInt(t);d(t=>t.map(t=>t.no===e?(t.m_status!==a&&(1===a?h(e=>e+1):1===t.m_status&&h(e=>e-1)),{...t,m_status:a}):t))};return(0,s.jsxs)("div",{children:[(0,s.jsx)("h6",{style:{padding:"12px 0",textAlign:"center"},children:"目前申請加入的使用者"}),l.map(e=>(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{style:{padding:"12px 0 6px 12px",fontSize:"18px"},children:[(0,s.jsx)(p,{avatar:e.avatar,nickName:e.nick_name}),(0,s.jsx)("span",{style:{marginLeft:"10px"},children:e.nick_name})]}),(0,s.jsx)("div",{style:{display:"flex",justifyContent:"center"},children:(0,s.jsx)(L,{member:e,handleRadioChange:_},e.no)})]},e.join_user_id)),(0,s.jsxs)("div",{style:{textAlign:"center",paddingTop:"12px"},children:["團員/上限: ",m," / ",a]})]})};function O(e){let{chat_at:t,chat_by:a,onSubmit:i}=e,[r,o]=(0,n.useState)(""),[l,m]=(0,n.useState)(!1),{openSnackbar:h}=(0,d.Ds)();(0,n.useEffect)(()=>{let e=r.length;m(e>=3&&e<=80)},[r]);let x=async e=>{e.preventDefault(),l&&((await fetch(c.iK,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chat_at:t,chat_by:a,chat_text:r})})).ok?(h("留言已送出!","success"),o(""),i()):h("留言發送失敗...","error"))};return(0,s.jsx)("div",{className:"row",children:(0,s.jsx)("div",{className:"typechat",children:(0,s.jsxs)("form",{onSubmit:x,children:[(0,s.jsx)("input",{type:"text",className:"form-control",id:"chat_text",name:"chat_text",value:r,onChange:e=>o(e.target.value),placeholder:"請輸入留言"}),(0,s.jsx)("div",{style:{textAlign:"center",marginTop:"12px"},children:(0,s.jsx)("button",{className:g().buttonBrown,children:"送出留言"})})]})})})}var z=e=>{let{chat_at:t,submissionCount:a}=e,[i,r]=(0,n.useState)([]),o=async e=>{let t=c.xE+e;try{let e=await fetch(t),a=await e.json();a.success&&r(a.data)}catch(e){console.error("Error fetching chat data: ",e)}};return(0,n.useEffect)(()=>{t&&o(t)},[t,a]),(0,s.jsx)(s.Fragment,{children:(0,s.jsx)("div",{className:"row",children:i.map(e=>(0,s.jsx)("div",{children:(0,s.jsxs)("div",{className:"row",children:[(0,s.jsxs)("div",{className:g().chatlist,children:[(0,s.jsx)(p,{avatar:e.avatar,nickName:e.nick_name,width:26,height:26}),(0,s.jsxs)("span",{style:{marginLeft:"12px"},children:[e.nick_name,"："]})]}),(0,s.jsx)("div",{style:{padding:"0 0 12px 24px"},children:e.chat_text}),(0,s.jsxs)("div",{style:{padding:"0 0 12px 24px"},children:["-- ",(0,u.o0)(e.create_at)]}),(0,s.jsx)("hr",{})]})},e.chat_id))})})},J=e=>{let{chat_at:t,chat_by:a}=e,[i,o]=(0,n.useState)(0);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:g().borderbox,children:(0,s.jsxs)("div",{className:"row",children:[(0,s.jsx)(r(),{href:"#addChat",style:{color:"#b99755"},children:(0,s.jsx)("h4",{style:{textAlign:"center",padding:"12px"},children:"留言區"})}),(0,s.jsx)("div",{className:g().titleBL}),(0,s.jsx)(z,{chat_at:t,submissionCount:i}),a?(0,s.jsx)("div",{id:"addChat",children:(0,s.jsx)(O,{chat_at:t,chat_by:a,onSubmit:()=>{o(e=>e+1)}})}):(0,s.jsx)(s.Fragment,{})]})})," "]})},q=e=>{let{status:t=""}=e,a="",n="";switch(t){case"1":a="隊伍成團囉，團長加油！",n="/ghost/ghost_05.png";break;case"2":a="此隊伍已成團，要看看其他團隊嗎？",n="/ghost/ghost_06.png";break;case"3":a="您已申請加入此團隊，請靜待團長許可",n="/ghost/ghost_01.png"}return(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)("div",{style:{textAlign:"center",padding:"32px 0 16px 0"},children:[(0,s.jsx)("h4",{children:a}),(0,s.jsx)(x(),{src:n,alt:"",width:125,height:100})]})})};function W(){let e=(0,o.useRouter)(),{auth:t}=(0,l.aC)(),[a,i]=(0,n.useState)([]),[h,x]=(0,n.useState)(!1),[_,u]=(0,n.useState)([]),[p,j]=(0,n.useState)(!1),[f,y]=(0,n.useState)(!1),[v,w]=(0,n.useState)(0),[k,C]=(0,n.useState)("going"),{openSnackbar:N}=(0,d.Ds)(),T=async e=>{let t=c.A6+e;try{let e=await fetch(t),a=await e.json();a.success&&i(a.data)}catch(e){}},B=async e=>{let a=c.w4+e;try{let e=await fetch(a),s=await e.json();if(s.success){w(s.data.length);let e=s.data.some(e=>e.join_user_id===t.id);x(e)}}catch(e){}},F=async()=>{let{team_id:a}=e.query,s={join_team_id:a,join_user_id:t.id};try{let e=await fetch(c.Jo,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});(await e.json()).success?B(a):N("加入團隊失敗","error")}catch(e){N("加入團隊時發生錯誤","error")}};return((0,n.useEffect)(()=>{if(e.isReady){let{team_id:t}=e.query;t&&(T(t),B(t))}},[e.isReady]),a)?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(m.Z,{title:"糾團",background:"dark",children:[(0,s.jsx)("div",{className:g().teamsPage,children:(0,s.jsxs)("div",{className:"container",children:[(0,s.jsx)("div",{className:g().pageTitle,children:(0,s.jsx)("h2",{children:"團隊頁面"})}),(0,s.jsx)("div",{className:"".concat(g().teamsSection," row"),children:(0,s.jsxs)("div",{className:g().borderbox,children:[(0,s.jsx)("div",{className:"row",children:(0,s.jsx)(b,{teamData:a,memberCount:v})}),(0,s.jsx)("div",{className:"row",children:"已成團"===a.team_status?(0,s.jsx)(s.Fragment,{children:t.id===a.user_id?(0,s.jsx)(q,{status:"1"}):(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(r(),{href:"./",style:{color:"#FFF"},children:(0,s.jsx)(q,{status:"2"})})})}):(0,s.jsx)(s.Fragment,{children:t.id?(0,s.jsx)("div",{style:{textAlign:"center",padding:"16px"},children:t.id===a.user_id?(0,s.jsx)(s.Fragment,{children:(0,s.jsx)("button",{onClick:()=>j(!0),className:g().buttonBrown,children:"管理團員"})}):h?(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(q,{status:"3"})}):(0,s.jsx)(s.Fragment,{children:(0,s.jsx)("button",{onClick:()=>y(!0),className:g().buttonBrown,children:"申請加入"})})}):(0,s.jsx)(s.Fragment,{})})})]},a.team_id)})]})}),(0,s.jsx)(s.Fragment,{children:(0,s.jsx)("div",{className:"container",children:(0,s.jsx)(J,{chat_at:a.team_id,chat_by:t.id})})})]}),(0,s.jsx)(A,{open:p,onClose:()=>j(!1),modalTitle:"管理團員",modalBody:(0,s.jsx)(I,{team_id:e.query.team_id,team_limit:a.team_limit,onMemberCountChange:C,onStatusChange:C,memberData:_,onMemberDataChange:u}),team_id:e.query.team_id,TeamReady:k,memberData:_,refreshTeamData:()=>T(e.query.team_id)}),(0,s.jsx)(S,{open:f,onClose:()=>y(!1),modalTitle:"申請加入",modalBody:(0,s.jsxs)("div",{children:["加入後，需等待團長審核",(0,s.jsx)("br",{}),"待人數到達預定上限後即可成團。"]}),modalBody2:(0,s.jsx)("div",{children:"已成功加入隊伍！ "}),buttonLabel:"確定加入！",onButtonClick:F,buttonLabel2:"確定"})]}):(0,s.jsx)("div",{children:"Loading..."})}},76214:function(e){e.exports={teamsPage:"teams_teamsPage__WIH5F",teamsNotice:"teams_teamsNotice__ffITv",formCheck:"teams_formCheck__vQLqq",pageTitle:"teams_pageTitle__iN_6w",secTitle:"teams_secTitle__RDW5F",borderbox:"teams_borderbox__xfhzW",tourInfo:"teams_tourInfo__yUVpe",teamsSection:"teams_teamsSection__yvYjf",teamUnite:"teams_teamUnite___J280",teamCard:"teams_teamCard__7WL7A",teamTourInfo:"teams_teamTourInfo__heX5v",bb:"teams_bb__S64up",teamlistblock:"teams_teamlistblock__eihys",teamlistblock1:"teams_teamlistblock1__hTYo1",bb2:"teams_bb2__Soc4N",preteamcard:"teams_preteamcard__J4dO1",teamPaTitle:"teams_teamPaTitle__KXqlf",titleBL:"teams_titleBL__7lR4x",titleLink:"teams_titleLink__DFx_f",teamForm:"teams_teamForm__Bs_zj",sty:"teams_sty__scYls",chatlist:"teams_chatlist__L_r0_",teamTable:"teams_teamTable__ChlJA",teamTitle:"teams_teamTitle__D2tR_",teamContent:"teams_teamContent__FDc8w",diffeasy:"teams_diffeasy__IBSeB",diffmedium:"teams_diffmedium__5v8xR",diffhard:"teams_diffhard__RrQb8","MuiAccordionActions-spacing":"teams_MuiAccordionActions-spacing__caGEf",avatarImg:"teams_avatarImg__vWpkH",buttonBrown:"teams_buttonBrown__K5g73",teamButton:"teams_teamButton__1nqQe",noDataInfo:"teams_noDataInfo__gEhOC"}}},function(e){e.O(0,[5970,4838,9317,4396,6660,509,2961,4321,2678,4885,959,6497,7601,7614,3197,3483,2888,9774,179],function(){return e(e.s=13777)}),_N_E=e.O()}]);