(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2222],{72590:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/checkout",function(){return n(67620)}])},48043:function(e,t,n){"use strict";n.d(t,{Z:function(){return c}});var i=n(85893),r=n(61990),o=n.n(r),s=n(74931),a=n(67294);function c(e){let t,{name:n="",type:r="",value:c="",placeholder:l="",disabled:d=!1,inputStyles:u="def",onChange:p=()=>{},onBlur:x=()=>{}}=e,[h,m]=(0,a.useState)(!1),[f,b]=(0,a.useState)("");return null===c&&(c=""),"def"===u&&(t=!1===d?o().inputDefault:o().inputDisabled),"line"===u&&(t=!1===d?o().inputDefaultLine:o().inputDisabledLine),(0,a.useEffect)(()=>{b(r)},[]),(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)("div",{className:o().input,children:[(0,i.jsx)("input",{name:n,type:f,value:c,placeholder:l,disabled:!0===d?"disabled":"",className:t,onChange:p,onBlur:x}),(0,i.jsx)("button",{type:"button",className:o().eyeIcon,onClick:()=>{let e=!h;b(e?"text":"password"),m(e)},children:"def"===u&&"password"===r&&!1===d?h?(0,i.jsx)(s.y7o,{}):(0,i.jsx)(s.HR2,{}):null})]})})}},42916:function(e,t,n){"use strict";n.d(t,{Z:function(){return u}});var i=n(85893),r=n(86605),o=n(42179),s=n(747),a=n(83886);let c="#d9d9d9",l=(0,a.Z)({components:{MuiSelect:{styleOverrides:{root:{height:"44px",width:"100%",fontFamily:"Noto Serif JP, serif","& .MuiSelect-select":{padding:"8px 16px"},"& .MuiOutlinedInput-notchedOutline":{border:"".concat("2px"," solid ").concat(c),lineHeight:1,borderRadius:"8px"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"#bbb29f"},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:"#bbb29f",boxShadow:"0 0 0 3px ".concat("#efede8")},"& .MuiSelect-icon":{transition:"200ms"}}}},MuiPaper:{styleOverrides:{root:{border:"".concat("2px"," solid ").concat(c),borderRadius:"8px",boxShadow:"none"}}},MuiList:{styleOverrides:{root:{maxHeight:"300px",overflow:"auto"}}},MuiMenuItem:{styleOverrides:{root:{fontFamily:"Noto Serif JP, serif","&.Mui-selected":{backgroundColor:"#efede8"},"&.Mui-selected:hover":{backgroundColor:"#efede8"}}}}}});var d=n(48234);function u(e){let{name:t="",value:n="placeholder",placeholder:a="",options:c=[],onChange:u=()=>{}}=e;if(!Array.isArray(c)){console.error("options不是陣列，請確認",c);return}return(0===c.length||null===n||""===n)&&(n="placeholder"),(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(s.Z,{theme:l,children:(0,i.jsxs)(o.Z,{name:t,value:n,onChange:u,IconComponent:d.Z,children:["placeholder"===n&&a?(0,i.jsx)(r.Z,{value:"placeholder",disabled:!0,children:a}):"",c.map((e,t)=>(0,i.jsx)(r.Z,{value:e.value,disabled:e.disabled,children:e.text},t))]})})})}},36452:function(e,t,n){"use strict";n.d(t,{Z:function(){return u}});var i=n(85893),r=n(94525),o=n.n(r),s=n(67294),a=n(11163),c=n(16075),l=n(62325),d=n(61435);function u(e){let{text:t="請先登入",btnText:n="登入",href:r=null,hideBtn:u=!1}=e,p=(0,a.useRouter)(),{auth:x,authIsReady:h}=(0,c.aC)(),{loginFormSwitch:m}=(0,l.NK)();return(0,s.useEffect)(()=>{p.isReady&&h&&!x.id&&m("Login")},[x.id,p.isReady,h]),(0,i.jsxs)("div",{className:o().container,children:[(0,i.jsx)("h6",{children:t}),(0,i.jsx)("img",{src:"/ghost/ghost_06.png",alt:"",className:o().ghostImg}),!u&&(0,i.jsx)(d.Z,{btnText:n,href:r,paddingType:"medium",onClick:()=>{m("Login")}})]})}},21399:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var i=n(85893),r=n(89262),o=n(98163);let s=(0,r.ZP)(o.Z)(e=>{let{type:t}=e;return{color:"pri"===t?"var(--sec-1)":"sec"===t?"var(--text-grey)":"var(--text-dark)",fontFamily:'"Noto Serif JP", serif',minWidth:"2rem",padding:"2px 8px","&:hover":{color:"pri"===t?"#8C764C":"sec"===t?"#868686":"var(--sec-1)",backgroundColor:"transparent"}}});function a(e){let{btnText:t,type:n="def",href:r="/",onClick:o}=e;return(0,i.jsx)(s,{size:"medium",type:n,href:r,onClick:o,children:t})}},7337:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var i=n(85893),r=n(57779),o=n.n(r),s=n(78773);function a(e){let{icon:t=s.DNl,content:n}=e;return(0,i.jsxs)("div",{className:o().iconTextRow,children:[(0,i.jsx)(t,{}),(0,i.jsx)("p",{className:o().contentText,children:n})]})}},83354:function(e,t,n){"use strict";n.d(t,{Z:function(){return d}});var i=n(85893),r=n(56309),o=n.n(r),s=n(89262),a=n(98163),c=n(11828);let l=(0,s.ZP)(a.Z)(e=>{let{bgtype:t}=e;return{gridColumn:"span 2",display:"flex",justifyContent:"space-between",color:"var(--text-dark)",fontSize:"1.125rem",fontFamily:'"Noto Serif JP", serif',backgroundColor:"fill"===t?"#F2F2F2":"white",border:"fill"===t?"none":"2px solid #F2F2F2",padding:"0.875rem 1.25rem",borderRadius:"var(--input-radius)",boxShadow:"none",width:"100%","&:hover":{backgroundColor:"#fafafa",boxShadow:"none"}}});function d(e){let{btnText:t="請選擇收件人資料",iconType:n="arrow",bgtype:r="fill",onClick:s={onClick:s}}=e;return(0,i.jsxs)(l,{bgtype:r,onClick:s,type:"button",children:[(0,i.jsx)("p",{className:o().btnTextStyle,children:t}),"arrow"===n?(0,i.jsx)(c.hjJ,{}):(0,i.jsx)(c.D0w,{})]})}},38187:function(e,t,n){"use strict";n.d(t,{Z:function(){return c}});var i=n(85893),r=n(4131),o=n.n(r),s=n(48043),a=n(81880);function c(e){let{label:t="label",name:n="",type:r="",value:c="",placeholder:l="",disabled:d=!1,errorText:u="",onChange:p=()=>{},onBlur:x=()=>{}}=e;return(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{htmlFor:n,className:o().label,children:t}),(0,i.jsx)(s.Z,{name:n,type:r,value:c,placeholder:l,disabled:d,onChange:p,onBlur:x}),(0,i.jsx)(a.Z,{errorText:u})]})}},81880:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});var i=n(85893),r=n(2398),o=n.n(r);function s(e){let{errorText:t=""}=e;return(0,i.jsx)("div",{className:o().errorBox,children:(0,i.jsx)("span",{className:o().errorText,children:t})})}},6097:function(e,t,n){"use strict";n.d(t,{Z:function(){return c}});var i=n(85893),r=n(81059),o=n.n(r),s=n(42916),a=n(81880);function c(e){let{label:t="label",name:n="",value:r="",placeholder:c="",options:l=[],errorText:d="",onChange:u=()=>{}}=e;return(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{htmlFor:n,className:o().label,children:t}),(0,i.jsx)(s.Z,{name:n,placeholder:c,value:r,options:l,onChange:u}),(0,i.jsx)(a.Z,{errorText:d})]})}},33745:function(e,t,n){"use strict";var i=n(11163),r=n(87066),o=n(45747);t.Z=()=>{let e=(0,i.useRouter)();return{handleOrderCancel:async e=>{try{if((await r.Z.post("".concat(o.Qm,"?order_id=").concat(e))).data.success)return{success:!0};return{success:!1,error:"取消訂單失敗"}}catch(e){return console.error("取消訂單錯誤",e),{success:!1,error:"取消訂單錯誤"}}},handleOrderPayment:async(t,n)=>{try{let i=await r.Z.get(o.EJ,{params:{orderId:t,checkoutTotal:n}});i.data.success&&e.push({pathname:"/ecpay-checkout",query:{html:encodeURIComponent(i.data.html)}})}catch(e){console.error("提交表單時出錯",e)}},handleReservationPayment:async t=>{try{let n=await r.Z.get(o.hP,{params:{reservation_id:t}});n.data.success&&e.push({pathname:"/ecpay-checkout",query:{html:encodeURIComponent(n.data.html)}})}catch(e){console.error("提交表單時出錯",e)}},handleReservationCancel:async e=>{try{if((await r.Z.post("".concat(o.oj,"?reservation_id=").concat(e))).data.success)return{success:!0};return{success:!1,error:"取消預約失敗"}}catch(e){return console.error("取消預約錯誤",e),{success:!1,error:"取消預約錯誤"}}}}}},3046:function(e,t,n){"use strict";var i=n(67294),r=n(11163);t.Z=()=>{let e=(0,r.useRouter)(),[t,n]=(0,i.useState)(0);return(0,i.useEffect)(()=>{n(document.body.clientWidth);let e=()=>{n(document.body.clientWidth)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[e.isReady]),t}},48234:function(e,t,n){"use strict";var i=n(64836);t.Z=void 0;var r=i(n(47955)),o=n(85893);t.Z=(0,r.default)((0,o.jsx)("path",{d:"M8.12 9.29 12 13.17l3.88-3.88c.39-.39 1.02-.39 1.41 0 .39.39.39 1.02 0 1.41l-4.59 4.59c-.39.39-1.02.39-1.41 0L6.7 10.7a.9959.9959 0 0 1 0-1.41c.39-.38 1.03-.39 1.42 0"}),"KeyboardArrowDownRounded")},67620:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return ed}});var i=n(85893),r=n(67294),o=n(53483),s=n(27326),a=n.n(s),c=n(87066),l=n(11163),d=n(28552),u=n(16075),p=n(62325),x=n(97928),h=n(45747);let m=(0,r.createContext)(),f=()=>(0,r.useContext)(m),b=e=>{let{children:t}=e,{auth:n}=(0,u.aC)(),[o,s]=(0,r.useState)(!1),[a,l]=(0,r.useState)(!1),[d,p]=(0,r.useState)(!1),[f,b]=(0,r.useState)([]),[_,v]=(0,r.useState)(null),[j,g]=(0,r.useState)(0),[y,C]=(0,r.useState)(0),{openSnackbar:I}=(0,x.Ds)(),Z=async()=>{try{let e=await c.Z.get("".concat(h.Yl,"?member_id=").concat(n.id));if(!e.status)throw Error("Failed to fetch member address");let t=e.data;if(b(t.rows),!_){let e=t.rows.find(e=>"1"===e.type)||t.rows[0];v(e)}}catch(e){console.log("Error fetching member address:",e)}},T=()=>{s(!1)},N=()=>{l(!1)},k=()=>{p(!1)},S=async e=>{try{let t=await fetch("".concat(h.VD,"/").concat(e),{method:"DELETE",headers:{"Content-Type":"application/json"}}),n=await t.json();n.success?(Z(),I("已成功刪除地址","success"),e===_.id&&v(null),console.log("delete address is: ".concat(e))):console.error("地址刪除失敗",n)}catch(e){console.error("刪除地址時出錯",e)}},w=async e=>{try{let t=await c.Z.post(h.Vm,e,{headers:{"Content-Type":"application/json"}});console.log(t.data),t.data.success&&t.data.addressId?(Z(),g(t.data.addressId),N(),T(),I("新增地址成功！","success")):I("新增地址失敗！","error"),console.log("new added id",t.data.addressId)}catch(e){console.error("新增地址錯誤",e)}},D=async e=>{try{let t=await c.Z.post(h.W7,e,{headers:{"Content-Type":"application/json"}});console.log(t.data),t.data.success?(Z(),g(e.id),k(),T(),I("編輯地址成功！","success")):I("編輯地址失敗！","error"),console.log("edit id",e.id)}catch(e){console.error("編輯地址錯誤",e)}};return(0,r.useEffect)(()=>{if(f){let e=f.find(e=>e.id===j);e&&v(e)}},[f,j]),(0,i.jsx)(m.Provider,{value:{isAddressSelectModalOpen:o,openAddressSelectModal:()=>{Z(),s(!0)},closeAddressSelectModal:T,isAddressAddModalOpen:a,openAddressAddModal:()=>{l(!0)},closeAddressAddModal:N,newAddressId:j,openAddressEditModal:()=>{p(!0)},closeAddressEditModal:k,goToEditModal:e=>{C(e),p(!0)},editId:y,isAddressEditModalOpen:d,setIsAddressEditModalOpen:p,setNewAddressId:g,setOrderAddress:v,fetchMemberAddress:Z,memberAddress:f,orderAddress:_,handleAddressDelete:S,handleSelectAddress:e=>{g(e),I("收件人地址已變更！","success"),T()},handleAddAddressSubmit:w,handleEditAddressSubmit:D},children:t})};var _=n(3046);let v=()=>{let[e,t]=(0,r.useState)({}),n=(0,r.useCallback)((e,n)=>{let i="";""===n&&(i="必填"),"recipientCityId"===e&&0===n&&(i="必填"),"recipientDistrictId"===e&&0===n&&(i="必填"),n&&("recipientName"!==e||/^[a-zA-Z\u4e00-\u9fa5 -]*$/.test(n)||(i="只能包含中文、英文"),"recipientMobile"!==e||/^09\d{8}$/.test(n)||(i="格式不符"),"recipientAddress"!==e||/^[a-zA-Z\u4e00-\u9fa5\d]*$/.test(n)||(i="只能包含中文、英文和數字"),"mobileInvoice"!==e||/^\/[0-9A-Z.+-]{7}$/.test(n)||(i="格式不符"),"recipientTaxId"!==e||/^\d{8}$/.test(n)||(i="格式不符")),t(t=>({...t,[e]:i}))},[]);return{errors:e,clearError:(0,r.useCallback)(e=>{t(t=>({...t,[e]:""}))},[]),validateField:n,timeout:1e3}};var j=n(33745),g=n(57850),y=n(61435),C=n(83354),I=n(11573),Z=n.n(I),T=n(89262),N=n(98163),k=n(7337),S=n(78773),w=n(84295),D=n(11828);let M=(0,T.ZP)(N.Z)(()=>({gridColumn:"span 2",display:"flex",justifyContent:"space-between",color:"var(--text-dark)",fontSize:"1.125rem",fontFamily:'"Noto Serif JP", serif',backgroundColor:"#F2F2F2",padding:"0.875rem 1.25rem",borderRadius:"var(--input-radius)",boxShadow:"none","&:hover":{backgroundColor:"#fafafa",boxShadow:"none"}}));function R(e){let{recipientName:t="",recipientMobile:n="",address:r=""}=e,{openAddressSelectModal:o}=f();return(0,i.jsxs)(M,{onClick:o,children:[(0,i.jsxs)("div",{className:Z().infoBox,children:[(0,i.jsx)("p",{className:Z().headerText,children:t}),(0,i.jsx)(k.Z,{content:n,icon:S.DNl}),(0,i.jsx)(k.Z,{content:r,icon:w.GUT})]}),(0,i.jsx)(D.hjJ,{})]})}var E=n(5513),F=n.n(E),B=n(89077),L=n(57628),A=n.n(L),O=n(7820),P=n(21399),J=n(54677);let H=(0,T.ZP)("div")(()=>({display:"flex",flexDirection:"column",alignItems:"start",justifyContent:"space-between",color:"var(--text-dark)",fontSize:"1.125rem",fontFamily:'"Noto Serif JP", serif',backgroundColor:"white",border:"2px solid #F2F2F2",padding:"0.875rem 1.25rem",borderRadius:"var(--input-radius)",boxShadow:"none","&:hover":{backgroundColor:"#fafafa",boxShadow:"none"}}));function z(e){let{name:t="無收件人",phone:n="無收件手機",address:r="無收件地址",href:o=null,addressId:s}=e,{handleAddressDelete:a,handleSelectAddress:c,openAddressEditModal:l,goToEditModal:d}=f(),{openConfirmDialog:u}=(0,O.W)();return(0,i.jsxs)("div",{children:[(0,i.jsxs)(H,{variant:"contained",href:o,children:[(0,i.jsxs)("div",{className:A().header,children:[(0,i.jsx)("p",{children:t}),(0,i.jsxs)("div",{className:A().btnStack,children:[(0,i.jsx)(P.Z,{btnText:"刪除",type:"sec",onClick:()=>{u(()=>{a(s)})},href:null}),(0,i.jsx)("div",{className:A().btnDivider,children:" "}),(0,i.jsx)(P.Z,{btnText:"編輯",type:"sec",href:null,onClick:()=>{d(s)}}),(0,i.jsx)("div",{className:A().btnDivider,children:" "}),(0,i.jsx)(P.Z,{btnText:"使用",type:"pri",onClick:()=>{c(s)},href:null})]})]}),(0,i.jsx)(k.Z,{content:n,icon:S.DNl}),(0,i.jsx)(k.Z,{content:r,icon:w.GUT})]}),(0,i.jsx)(J.Z,{dialogTitle:"確定要刪除地址嗎？",btnTextRight:"確定刪除",btnTextLeft:"取消"})]})}var G=n(92606),q=n.n(G),K=()=>{let[e,t]=(0,r.useState)([]),[n,i]=(0,r.useState)([]),[o,s]=(0,r.useState)([]),[a,l]=(0,r.useState)([]),d=async()=>{try{let e=await c.Z.get(h._J);if(e.data.success){let n=e.data.rows.map((e,t)=>({value:e.id,text:e.city_name}));t(e.data.rows),s(n)}}catch(e){console.error("Error fetching cities:",e)}},u=async()=>{try{let e=await c.Z.get(h.rl);e.data.success&&(e.data.rows.map((e,t)=>({value:e.id,text:e.district_name,city_id:e.city_id})),i(e.data.rows))}catch(e){console.error("Error fetching districts:",e)}},p=(0,r.useCallback)(e=>{l(n.filter(t=>t.city_id===e).map(e=>({value:e.id,text:e.district_name})))},[n]);return(0,r.useEffect)(()=>{d(),u()},[]),{cities:e,districts:n,cityOptions:o,districtOptions:a,filteredDistrictOptions:p,fetchCities:d,fetchDistricts:u}},W=n(38187),$=n(6097),Q=n(47442),U=n.n(Q),V=n(8285);function X(e){let{hintText:t="hintText"}=e;return(0,i.jsxs)("div",{className:U().validateFailedBox,children:[(0,i.jsx)(V.yZ3,{}),(0,i.jsx)("small",{children:t})]})}function Y(){let{auth:e}=(0,u.aC)(),{isAddressAddModalOpen:t,closeAddressAddModal:n,handleAddAddressSubmit:o}=f(),{memberProfile:s}=(0,d.j)(),{timeout:a,errors:c,validateField:l}=v(),[p,x]=(0,r.useState)(!0),{cityOptions:h,districtOptions:m,filteredDistrictOptions:b}=K(),[_,j]=(0,r.useState)(),[g,y]=(0,r.useState)(),[C,I]=(0,r.useState)({memberId:e.id,recipientCityId:0,recipientDistrictId:0,recipientName:"",recipientMobile:"",recipientAddress:""}),Z=e=>{let{name:t,value:n}=e.target;"recipientCityId"===t&&(j(n),console.log(t,n)),"recipientDistrictId"===t&&(y(n),console.log(t,n)),I(e=>({...e,[t]:n})),console.log(C),setTimeout(()=>{l(t,n),console.log("表單驗證",c)},a)},T=e=>{let{name:t,value:n}=e.target;l(t,n),console.log("表單驗證",c)};return(0,r.useEffect)(()=>{y(),b(_),console.log("after selectedCity, city: ",_,"district",m)},[_]),(0,r.useEffect)(()=>{I(e=>({...e,recipientName:s.name,recipientMobile:s.mobile_phone}))},[]),(0,i.jsx)(B.Z,{title:"新增收件人資料",modalHeight:"720px",btnTextLeft:"取消",btnTextRight:"確定新增",onClickLeft:n,onClickRight:()=>{let e=!0;["recipientCityId","recipientDistrictId","recipientName","recipientMobile","recipientAddress"].forEach(t=>{l(t,C[t]),(!C[t]||c[t])&&(e=!1)}),x(e),e&&o(C)},isOpen:t,children:(0,i.jsxs)("form",{name:"addAddressForm",className:q().formBox,children:[!p&&(0,i.jsx)("div",{className:q().span2,children:(0,i.jsx)(X,{hintText:"請確認表單欄位"})}),(0,i.jsx)(W.Z,{label:"姓名",name:"recipientName",value:C.recipientName||"",errorText:c.recipientName||"",onChange:Z,onBlur:T}),(0,i.jsx)(W.Z,{label:"手機",name:"recipientMobile",value:C.recipientMobile,errorText:c.recipientMobile||"",onChange:Z,onBlur:T}),(0,i.jsx)($.Z,{name:"recipientCityId",label:"縣市",placeholder:"請選擇",value:_,options:h,errorText:c.recipientCityId||"",onChange:Z}),(0,i.jsx)($.Z,{name:"recipientDistrictId",label:"地區",placeholder:"請選擇",value:g,options:m,errorText:c.recipientDistrictId||"",onChange:Z}),(0,i.jsx)("div",{className:q().span2,children:(0,i.jsx)(W.Z,{label:"地址",name:"recipientAddress",value:C.recipientAddress,errorText:c.recipientAddress||"",onChange:Z,onBlur:T})})]})})}var ee=n(43036),et=n(79512),en=n.n(et);function ei(){let{isAddressEditModalOpen:e,closeAddressEditModal:t,handleEditAddressSubmit:n,memberAddress:o,editId:s}=f(),[a,c]=(0,r.useState)({}),[l,d]=(0,r.useState)({}),{timeout:u,errors:p,validateField:x}=v(),[h,m]=(0,r.useState)(!0),{cityOptions:b,districtOptions:_,filteredDistrictOptions:j}=K(),[g,y]=(0,r.useState)(),[C,I]=(0,r.useState)(),Z=e=>{let{name:t,value:n}=e.target;"recipientCityId"===t&&y(n),"recipientDistrictId"===t&&I(n),d(e=>({...e,[t]:n})),console.log(l),setTimeout(()=>{x(t,n),console.log("表單驗證",p)},u)},T=e=>{let{name:t,value:n}=e.target;x(t,n)};return(0,r.useEffect)(()=>{if(s>0){let e=o.find(e=>e.id===s);c(e),console.log("editId",s,e)}},[s]),(0,r.useEffect)(()=>{a&&0!==Object.keys(a).length&&(d({id:s,memberId:a.user_id,recipientCityId:a.city_id,recipientDistrictId:a.district_id,recipientName:a.recipient_name,recipientMobile:a.mobile_phone,recipientAddress:a.address}),y(a.city_id),j(a.city_id),I(a.district_id))},[a,j]),(0,r.useEffect)(()=>{I(),j(g)},[g]),(0,i.jsx)(B.Z,{title:"編輯收件人資料",modalHeight:"720px",btnTextLeft:"取消",btnTextRight:"儲存",onClickLeft:t,onClickRight:()=>{let e=!0;["recipientCityId","recipientDistrictId","recipientName","recipientMobile","recipientAddress"].forEach(t=>{x(t,l[t]),(!l[t]||p[t])&&(e=!1)}),m(e),e&&n(l)},isOpen:e,children:(0,i.jsxs)("form",{name:"addAddressForm",className:en().formBox,children:[!h&&(0,i.jsx)("div",{className:en().span2,children:(0,i.jsx)(X,{hintText:"請確認表單欄位"})}),(0,i.jsx)(W.Z,{label:"姓名",name:"recipientName",value:l.recipientName||"",errorText:p.recipientName||"",onChange:Z,onBlur:T}),(0,i.jsx)(W.Z,{label:"手機",name:"recipientMobile",value:l.recipientMobile||"",errorText:p.recipientMobile||"",onChange:Z,onBlur:T}),(0,i.jsx)($.Z,{name:"recipientCityId",label:"縣市",placeholder:"請選擇",value:g,options:b,errorText:p.recipientCityId||"",onChange:Z}),(0,i.jsx)($.Z,{name:"recipientDistrictId",label:"地區",placeholder:"請選擇",value:C,options:_,errorText:p.recipientDistrictId||"",onChange:Z}),(0,i.jsx)("div",{className:en().span2,children:(0,i.jsx)(W.Z,{label:"地址",name:"recipientAddress",value:l.recipientAddress||"",errorText:p.recipientAddress||"",onChange:Z,onBlur:T})})]})})}function er(){let{auth:e}=(0,u.aC)(),{isAddressSelectModalOpen:t,closeAddressSelectModal:n,isAddressAddModalOpen:r,memberAddress:o,openAddressAddModal:s,isAddressEditModalOpen:a}=f();return(0,i.jsxs)(B.Z,{title:"請選擇收件人",modalHeight:"720px",btnLeftHidden:!0,btnTextRight:"關閉",isOpen:t,handleClose:n,children:[(0,i.jsxs)("div",{className:F().contentBox,children:[0===o.length?(0,i.jsx)(ee.Z,{text:"無收件人資料",backgroundColor:"#f2f2f2",borderRadius:"var(--input-radius)"}):o.map((t,n)=>(0,i.jsx)(z,{addressId:t.id,name:t.recipient_name,phone:t.mobile_phone,address:t.city_name+t.district_name+t.address,href:null,memberId:e.id},t.id)),(0,i.jsx)(C.Z,{memberId:e.id,btnText:"新增收件人資料",iconType:"add",bgtype:"outline",onClick:s})]}),r&&(0,i.jsx)(Y,{}),a&&(0,i.jsx)(ei,{})]})}var eo=n(55750),es=n(36109),ea=n(36452),ec=n(69904);function el(){let e=(0,l.useRouter)(),{auth:t,authIsReady:n}=(0,u.aC)(),{loginFormSwitch:o}=(0,p.NK)(),{timeout:s,errors:m,validateField:b}=v(),[I,Z]=(0,r.useState)("member"),{handleOrderPayment:T}=(0,j.Z)(),N=(0,_.Z)(),{openSnackbar:k}=(0,x.Ds)(),[S,w]=(0,r.useState)(N),{isAddressSelectModalOpen:D,openAddressSelectModal:M,closeAddressSelectModal:E,fetchMemberAddress:F,memberAddress:B,orderAddress:L}=f(),{checkoutItems:A,checkoutTotal:O,subtotal:P,cartBadgeQty:J,clearCart:H,deliverFee:z,fetchMemberProfile:G,formData:q,setFormData:K,selectedCoupons:Q,calculateDiscountTotal:U,usableCoupons:V,useableProductCoupons:X,discountTotal:Y}=(0,d.j)(),ee=e=>{let{name:t,value:n}=e.target;K({...q,[t]:n}),setTimeout(()=>{b(t,n)},s)},et=e=>{let{name:t,value:n}=e.target;b(t,n)},en=async e=>{e.preventDefault(),B.filter(e=>!0===e.selected);let n=A.map(e=>({productId:e.product_id,productOriginalPrice:e.price,orderQty:e.cart_product_quantity,cartProductCouponId:e.cart_product_coupon_id})),i={...q};if("member"===I?i={...i,memberInvoice:1,mobileInvoice:"",recipientTaxId:""}:"mobile"===I?(i={...i,memberInvoice:0,mobileInvoice:q.mobileInvoice,recipientTaxId:""},m.recipientTaxId=""):"tax"===I&&(i={...i,memberInvoice:0,mobileInvoice:"",recipientTaxId:q.recipientTaxId},m.mobileInvoice=""),b("mobileInvoice",q.mobileInvoice),b("recipientTaxId",q.recipientTaxId),m.mobileInvoice||m.recipientTaxId){alert("請確認欄位");return}let r=null;Q.length>0&&(r=Q[0].coupon_id);let o={...i,memberId:t.id,recipientName:L.recipient_name,recipientMobile:L.mobile_phone,recipientDistrictId:L.district_id,recipientAddress:L.address,deliverFee:z,orderCouponId:r,orderItems:n};try{let e=await c.Z.post(h.YF,o);if(e.data.success){let t=e.data.orderId;H(),k("訂單已成立","success"),await T(t,O)}}catch(e){console.error("提交表單時出錯",e)}};return((0,r.useEffect)(()=>{w(N)},[N]),(0,r.useEffect)(()=>{e.isReady&&n&&(t.id&&(F(),G()),t.id||o("Login"))},[t.id,e.isReady,n]),!t.id&&n)?(0,i.jsx)(ea.Z,{}):(0,i.jsxs)("section",{className:a().sectionContainer,children:[(0,i.jsx)("h2",{className:a().h2Style,children:"結帳"}),J<=0&&(0,i.jsx)("div",{className:a().contentContainer,children:(0,i.jsx)(es.Z,{})}),J>0&&(0,i.jsxs)("form",{id:"_form_aiochk",method:"post",name:"checkoutForm",onSubmit:en,className:a().contentContainer,children:[(0,i.jsxs)("div",{className:a().checkoutLeft,children:[(0,i.jsx)("h5",{children:"訂購資訊"}),(0,i.jsx)("div",{className:a().itemList,children:(0,i.jsx)(g.Z,{type:S<640?"small":"def"})}),(0,i.jsx)(ec.Z,{}),(0,i.jsx)(eo.Z,{subtotal:P,deliverFee:z,totalDiscount:Y,checkoutTotal:O})]}),(0,i.jsxs)("div",{className:a().checkoutRight,children:[(0,i.jsx)("h5",{children:"收件資料"}),(0,i.jsxs)("div",{className:a().checkoutRightMain,children:[D&&(0,i.jsx)(er,{onClose:E}),L?(0,i.jsx)(R,{recipientName:L.recipient_name,recipientMobile:L.mobile_phone,address:L.city_name+L.district_name+L.address},L.id):(0,i.jsx)(C.Z,{onClick:M}),(0,i.jsx)($.Z,{name:"invoice_type",label:"發票形式",placeholder:"請選擇",value:I,options:[{value:"member",text:"會員載具"},{value:"mobile",text:"手機載具"},{value:"tax",text:"統一編號"}],onChange:e=>{Z(e.target.value)}}),"mobile"===I&&(0,i.jsx)(W.Z,{name:"mobileInvoice",label:"手機載具",value:q.mobileInvoice,errorText:m.mobileInvoice||"",onChange:ee,onBlur:et}),"tax"===I&&(0,i.jsx)(W.Z,{name:"recipientTaxId",label:"統一編號",value:q.recipientTaxId,errorText:m.recipientTaxId||"",onChange:ee,onBlur:et})]}),(0,i.jsx)(y.Z,{btnText:"前往付款",type:"submit",href:null,paddingType:"medium",className:a().btnStyle})]})]})]})}function ed(){return(0,i.jsx)(o.Z,{title:"結帳",background:"light",children:(0,i.jsx)(b,{children:(0,i.jsx)(el,{})})})}},61990:function(e){e.exports={inputDefault:"input01_inputDefault__rC9_w",inputDefaultLine:"input01_inputDefaultLine__A5JCq",inputDisabled:"input01_inputDisabled__lYkq_",inputDisabledLine:"input01_inputDisabledLine__4myS3",input:"input01_input__IyFIT",eyeIcon:"input01_eyeIcon__MsDLy"}},47442:function(e){e.exports={validateFailedBox:"error-hint_validateFailedBox__GATeX"}},94525:function(e){e.exports={container:"redirect-guide_container__9fNVP",ghostImg:"redirect-guide_ghostImg__IwOg5"}},92606:function(e){e.exports={formBox:"add-address-modal_formBox__ETHEQ",span2:"add-address-modal_span2__Z2v11"}},57779:function(e){e.exports={iconTextRow:"address-info-row_iconTextRow__H74kf",contentText:"address-info-row_contentText__ifGKI"}},79512:function(e){e.exports={formBox:"edit-address-modal_formBox__dGjjI",span2:"edit-address-modal_span2__SDOR2"}},57628:function(e){e.exports={header:"recipient-button-edit_header__CjCZE",btnStack:"recipient-button-edit_btnStack__FBO1G",btnDivider:"recipient-button-edit_btnDivider__p8mH8"}},11573:function(e){e.exports={infoBox:"recipient-button-selected_infoBox__5TI3Y",headerText:"recipient-button-selected_headerText__81D_C"}},56309:function(e){e.exports={btnTextStyle:"recipient-button_btnTextStyle__Jvd9n"}},5513:function(e){e.exports={contentBox:"select-address-modal_contentBox__7NSNX"}},27326:function(e){e.exports={h2Style:"checkout-page_h2Style__Jgh_E",sectionContainer:"checkout-page_sectionContainer__etQ5M",contentContainer:"checkout-page_contentContainer__JJ5aM",checkoutLeft:"checkout-page_checkoutLeft__9KOKS",checkoutRight:"checkout-page_checkoutRight__W28w7",itemList:"checkout-page_itemList__q0j_8",btnStyle:"checkout-page_btnStyle__M4bxL",checkoutRightMain:"checkout-page_checkoutRightMain__plyS2"}},4131:function(e){e.exports={label:"order-input-box_label__GgH94"}},2398:function(e){e.exports={errorBox:"order-input-error_errorBox___OsnD",errorText:"order-input-error_errorText__54eeM"}},81059:function(e){e.exports={label:"order-select-box_label__l_2Vl"}}},function(e){e.O(0,[5970,4838,9317,4396,6660,509,2961,4321,4817,959,6497,2179,3483,2888,9774,179],function(){return e(e.s=72590)}),_N_E=e.O()}]);