(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9747],{40375:function(e,t){"use strict";t.Z={border:0,clip:"rect(0 0 0 0)",height:"1px",margin:"-1px",overflow:"hidden",padding:0,position:"absolute",whiteSpace:"nowrap",width:"1px"}},90411:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/user/orders/details/reviews/[order_id]",function(){return r(14975)}])},48043:function(e,t,r){"use strict";r.d(t,{Z:function(){return d}});var n=r(85893),i=r(61990),a=r.n(i),o=r(74931),s=r(67294);function d(e){let t,{name:r="",type:i="",value:d="",placeholder:c="",disabled:l=!1,inputStyles:u="def",onChange:_=()=>{},onBlur:p=()=>{}}=e,[x,h]=(0,s.useState)(!1),[f,m]=(0,s.useState)("");return null===d&&(d=""),"def"===u&&(t=!1===l?a().inputDefault:a().inputDisabled),"line"===u&&(t=!1===l?a().inputDefaultLine:a().inputDisabledLine),(0,s.useEffect)(()=>{m(i)},[]),(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{className:a().input,children:[(0,n.jsx)("input",{name:r,type:f,value:d,placeholder:c,disabled:!0===l?"disabled":"",className:t,onChange:_,onBlur:p}),(0,n.jsx)("button",{type:"button",className:a().eyeIcon,onClick:()=>{let e=!x;m(e?"text":"password"),h(e)},children:"def"===u&&"password"===i&&!1===l?x?(0,n.jsx)(o.y7o,{}):(0,n.jsx)(o.HR2,{}):null})]})})}},44760:function(e,t,r){"use strict";r.d(t,{Z:function(){return l}});var n=r(85893),i=r(99785),a=r.n(i),o=r(33367),s=r(35514),d=r(66641),c=r(84295);function l(e){let{type:t="def",title:r="標題",btnHref:i=null,btnHidden:l=!1,btnText:u="按鈕",onClickBtn:_,onClickBack:p=()=>{window.history.back()}}=e;return(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:a().orderDetailHeader,children:[(0,n.jsxs)("div",{className:a().headerLeft,children:["icon"===t&&(0,n.jsx)(o.Z,{onClick:p,href:null,children:(0,n.jsx)(c.Wuc,{className:a().iconStyles})}),(0,n.jsx)("h5",{children:r})]}),!l&&(0,n.jsx)(s.Z,{btnText:u,href:i,onClick:_})]}),(0,n.jsx)(d.Z,{margin:"1.5rem 0"})]})}},22535:function(e,t,r){"use strict";r.d(t,{Z:function(){return l}});var n=r(85893),i=r(11163),a=r(41664),o=r.n(a),s=r(98216),d=r.n(s),c=r(78773);function l(){let e=(0,i.useRouter)(),t=t=>t.some(t=>e.pathname.startsWith(t));return(0,n.jsx)("ul",{className:d().userTab,children:[{key:"profile",name:"會員資料",link:"/user/profile",paths:["/user/profile","/user/reset-password"]},{key:"reservation",name:"行程預約",link:"/user/reservation/ongoing",paths:["/user/reservation"]},{key:"orders",name:"商品訂單",link:"/user/orders/ongoing",paths:["/user/orders"]},{key:"favorite",name:"我的收藏",link:"/user/favorite",paths:["/user/favorite"]},{key:"coupons",name:"優惠券",link:"/user/coupon/ongoing",paths:["/user/coupon"]}].map((e,r)=>(0,n.jsx)("li",{className:t(e.paths)?d().active:"",children:(0,n.jsxs)(o(),{href:e.link,children:[(0,n.jsx)(c.ycZ,{}),(0,n.jsx)("span",{children:e.name})]})},e.key))})}},96345:function(e,t,r){"use strict";r.d(t,{Z:function(){return o}});var n=r(85893);r(67294);var i=r(5024),a=r.n(i);function o(e){let{userTab:t,userTabSec:r,sectionRight:i}=e;return(0,n.jsx)("section",{className:a().sectionContainer,children:(0,n.jsxs)("div",{className:a().sectionBody,children:[t,(0,n.jsxs)("div",{className:a().sectionRight,children:[r,i]})]})})}},63007:function(e,t,r){"use strict";r.d(t,{Z:function(){return d}});var n=r(85893),i=r(594),a=r.n(i),o=r(57544),s=r(19719);function d(e){let{order_date:t,merchant_trade_no:r,deliver_fee:i,total_price:d,payment_date:c,payment_type:l,full_address:u,order_status_id:_,discount_total:p,order_status_name:x,paymentHidden:h=!1}=e;return(0,n.jsxs)("div",{className:a().orderInfoBox,children:[(0,n.jsx)(s.Z,{label:"訂單日期",content:(0,o.p6)(t)}),!!r&&(0,n.jsx)(s.Z,{label:"訂單編號",content:r}),!h&&(0,n.jsx)(s.Z,{label:"折扣",content:(0,o.T4)(p)}),!h&&(0,n.jsx)(s.Z,{label:"運費",content:(0,o.T4)(i)}),!h&&(0,n.jsx)(s.Z,{label:"合計",content:(0,o.T4)(d)}),!h&&!!c&&(0,n.jsx)(s.Z,{label:"付款時間",content:"".concat(c," / ").concat(l)}),!h&&(0,n.jsx)(s.Z,{label:"地址",content:u}),(0,n.jsx)(s.Z,{status:x})]})}},19719:function(e,t,r){"use strict";r.d(t,{Z:function(){return o}});var n=r(85893),i=r(48465),a=r.n(i);function o(e){let{label:t,content:r}=e;return(0,n.jsxs)("div",{className:a().iconTextRow,children:[(0,n.jsx)("p",{className:a().label,children:t}),(0,n.jsx)("p",{children:r})]})}},8227:function(e,t,r){"use strict";var n=r(67294),i=r(87066),a=r(45747);t.Z=()=>{let[e,t]=(0,n.useState)([]),[r,o]=(0,n.useState)([]),[s,d]=(0,n.useState)(!1);return{order:e,detail:r,anyReviewed:s,fetchOrderData:async e=>{try{let r=await i.Z.get("".concat(a.VO,"/").concat(e));if(r.data.status){let e=r.data.orderDetails.find(e=>1==e.review_status);d(!!e),t(r.data.orders[0]),o(r.data.orderDetails)}}catch(e){console.error("Error fetching order and order detail data:",e)}}}}},14975:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return D}});var n=r(85893),i=r(67294),a=r(11163),o=r(53483),s=r(96345),d=r(22535),c=r(25192),l=r.n(c),u=r(87066),_=r(8227),p=r(61435),x=r(69223),h=r.n(x),f=r(21173),m=r(75275);function v(e){let{rate:t=0,onChange:r,readOnly:i=!1}=e;return(0,n.jsx)(m.Z,{name:"size-medium",value:t,onChange:(e,t)=>{r(t)},readOnly:i})}var w=r(48043);function j(e){let{order_product_id:t=0,product_name:r="",product_img:i="",placeholder:a="請輸入評價",review:o="",rate:s=0,onChange:d,onRatingChange:c,readOnly:l=!1,review_date:u}=e;return(0,n.jsxs)("div",{className:h().orderItemBox,children:[(0,n.jsx)(f.Z,{imgSrc:i,width:"128px",height:"128px",smallWidth:"72px",smallHeight:"112px"}),(0,n.jsxs)("div",{className:h().orderItemBoxRight,children:[(0,n.jsx)("p",{className:h().productName,children:r}),l?(0,n.jsx)("p",{children:o}):(0,n.jsx)(w.Z,{name:"review",placeholder:a,value:o,inputStyles:"line",onChange:d}),(0,n.jsxs)("div",{className:h().ratingBox,children:[(0,n.jsx)(v,{readOnly:l,rate:s,onChange:c}),(0,n.jsx)("small",{children:u})]})]})]})}var g=r(44760),y=r(63007),b=r(97928),Z=r(45747);function N(e){let{order_id:t}=e,[r,a]=(0,i.useState)([]),[o,s]=(0,i.useState)([]),[d,c]=(0,i.useState)(!1),{order:x,detail:h,fetchOrderData:f}=(0,_.Z)(),{openSnackbar:m}=(0,b.Ds)(),v=async()=>{try{let e=await u.Z.get("".concat(Z.I,"/").concat(t));if(e.data.success){a(e.data.rows);let r=e.data.rows.map(e=>({order_id:+t,order_product_id:e.order_product_id,review:e.review||"",rate:e.rate||0}));s(r);let n=e.data.rows.find(e=>1===e.review_status);c(!!n),console.log("fetch",e.data.rows)}}catch(e){console.error("Error fetching order reviews:",e)}};(0,i.useEffect)(()=>{t>0&&(f(t),v())},[t]);let w=(e,t)=>{let{name:r,value:n}=e.target;s(e=>e.map(e=>e.order_product_id===t?{...e,[r]:n}:e)),console.log(o)},N=(e,t)=>{s(r=>r.map(r=>r.order_product_id===e?{...r,rate:t}:r)),console.log(o)},D=async e=>{e.preventDefault();try{let e=(await u.Z.post(Z.Ly,o)).data;console.log(e),e.success&&(v(),m("您的評價已送出！","success"))}catch(e){console.error("提交表單時出錯",e)}};return(0,n.jsxs)("form",{name:"orderReviews",onSubmit:D,className:l().orderDetailBox,children:[(0,n.jsx)(g.Z,{type:"icon",title:"訂單評價",btnHidden:!0}),(0,n.jsx)(y.Z,{order_date:null==x?void 0:x.order_date,merchant_trade_no:null==x?void 0:x.merchant_trade_no,paymentHidden:!0}),r.length>0&&r.map(e=>{let t=o.find(t=>t.order_product_id===e.order_product_id)||{review:"",rate:0},r=!0===d,i=r?e.review:t.review,a=r?e.rate:t.rate;return(0,n.jsx)(j,{order_product_id:e.order_product_id,product_name:e.product_name,product_img:"".concat(Z.DI,"/").concat(e.product_img),review:i,rate:a,onChange:t=>w(t,e.order_product_id),onRatingChange:t=>N(e.order_product_id,t),review_date:e.review_date,readOnly:r},e.order_product_id)}),!1===d&&(0,n.jsx)("div",{className:l().btnStack,children:(0,n.jsx)(p.Z,{type:"submit",btnText:"送出評價",href:null,paddingType:"medium"})})]})}function D(){let{order_id:e}=(0,a.useRouter)().query;return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(o.Z,{title:"訂單評價",pageName:"user",background:"light",children:(0,n.jsx)(s.Z,{userTab:(0,n.jsx)(d.Z,{}),sectionRight:(0,n.jsx)(N,{order_id:e})})})})}},61990:function(e){e.exports={inputDefault:"input01_inputDefault__rC9_w",inputDefaultLine:"input01_inputDefaultLine__A5JCq",inputDisabled:"input01_inputDisabled__lYkq_",inputDisabledLine:"input01_inputDisabledLine__4myS3",input:"input01_input__IyFIT",eyeIcon:"input01_eyeIcon__MsDLy"}},99785:function(e){e.exports={orderDetailHeader:"user-header_orderDetailHeader__kbfpq",headerLeft:"user-header_headerLeft__Pnam1",iconStyles:"user-header_iconStyles__HOlLP"}},98216:function(e){e.exports={userTab:"user-tab_userTab__oitHd",active:"user-tab_active__WQZR9"}},5024:function(e){e.exports={sectionContainer:"user-layout_sectionContainer__ZrxdZ",sectionBody:"user-layout_sectionBody__cHqmz",sectionRight:"user-layout_sectionRight__pqtpQ"}},594:function(e){e.exports={orderInfoBox:"order-detail-info_orderInfoBox__HuEgN"}},48465:function(e){e.exports={iconTextRow:"order-detail-row_iconTextRow__r0_MW",label:"order-detail-row_label__XXdNe"}},25192:function(e){e.exports={orderDetailBox:"order-reviews-page_orderDetailBox__HHK_H",orderDetailHeader:"order-reviews-page_orderDetailHeader__ElxWa",titleBox:"order-reviews-page_titleBox__l1KyQ",btnStack:"order-reviews-page_btnStack__MAZ0C"}},69223:function(e){e.exports={orderItemBox:"review-item-card_orderItemBox__Lh_rN",orderItemBoxRight:"review-item-card_orderItemBoxRight__rwFDM",productName:"review-item-card_productName__zmZyw",ratingBox:"review-item-card_ratingBox__ORcFS",orderReviewHintBox:"review-item-card_orderReviewHintBox__yauSE"}}},function(e){e.O(0,[5970,4838,9317,4396,6660,509,2961,4321,959,6497,5275,3483,2888,9774,179],function(){return e(e.s=90411)}),_N_E=e.O()}]);