(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6410],{34494:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/user/profile/set-2fa",function(){return t(8678)}])},22535:function(e,s,t){"use strict";t.d(s,{Z:function(){return u}});var n=t(85893),r=t(11163),i=t(41664),o=t.n(i),l=t(98216),a=t.n(l),c=t(78773);function u(){let e=(0,r.useRouter)(),s=s=>s.some(s=>e.pathname.startsWith(s));return(0,n.jsx)("ul",{className:a().userTab,children:[{key:"profile",name:"會員資料",link:"/user/profile",paths:["/user/profile","/user/reset-password"]},{key:"reservation",name:"行程預約",link:"/user/reservation/ongoing",paths:["/user/reservation"]},{key:"orders",name:"商品訂單",link:"/user/orders/ongoing",paths:["/user/orders"]},{key:"favorite",name:"我的收藏",link:"/user/favorite",paths:["/user/favorite"]},{key:"coupons",name:"優惠券",link:"/user/coupon/ongoing",paths:["/user/coupon"]}].map((e,t)=>(0,n.jsx)("li",{className:s(e.paths)?a().active:"",children:(0,n.jsxs)(o(),{href:e.link,children:[(0,n.jsx)(c.ycZ,{}),(0,n.jsx)("span",{children:e.name})]})},e.key))})}},96345:function(e,s,t){"use strict";t.d(s,{Z:function(){return o}});var n=t(85893);t(67294);var r=t(5024),i=t.n(r);function o(e){let{userTab:s,userTabSec:t,sectionRight:r}=e;return(0,n.jsx)("section",{className:i().sectionContainer,children:(0,n.jsxs)("div",{className:i().sectionBody,children:[s,(0,n.jsxs)("div",{className:i().sectionRight,children:[t,r]})]})})}},78519:function(e,s,t){"use strict";t.d(s,{Z:function(){return u}});var n=t(85893),r=t(1822),i=t.n(r),o=t(84295),l=t(33367),a=t(11163),c=t(34815);function u(e){let{text:s="",href:t,quickInput:r=""}=e,u=(0,a.useRouter)();return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"jsx-f8c0c1a5f1e34c31 title",children:[t?(0,n.jsx)(l.Z,{onClick:()=>{t&&u.push(t)},children:(0,n.jsx)(o.Wuc,{})}):null,(0,n.jsx)("h5",{className:"jsx-f8c0c1a5f1e34c31",children:s}),""===r?null:(0,n.jsx)(c.Z,{btnText:(0,n.jsx)("span",{style:{color:"#FFF"},className:"jsx-f8c0c1a5f1e34c31",children:"快速輸入"}),onClick:r})]}),(0,n.jsx)(i(),{id:"f8c0c1a5f1e34c31",children:".title.jsx-f8c0c1a5f1e34c31{width:100%;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-webkit-flex-direction:row;-moz-box-orient:horizontal;-moz-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;gap:1rem;padding-bottom:10px;margin-bottom:20px;border-bottom:1px solid#d9d9d9;svg {\r\n            fill: #b99755;\r\n            font-size: 1.25rem;\r\n          }\r\n        }"})]})}},8678:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return O}});var n=t(85893),r=t(67294),i=t(11163),o=t(16075),l=t(62325),a=t(53483),c=t(22535),u=t(96345),d=t(25675),x=t.n(d),p=t(87066),h=t(45747),f=t(67614),m=t(33367),j=t(96643),b=t(34815),g=t(61435),_=t(69236),k=t(99255),y=t(58544),w=t(23477),v=t(83886),Z=t(747),N=e=>{let{steps:s,activeStep:t,activeColor:r="#B99755",completedColor:i="#B99755"}=e,o=(0,v.Z)({components:{MuiStepper:{styleOverrides:{root:{width:"100%"}}},MuiStepIcon:{styleOverrides:{root:{"&.Mui-active":{color:r},"&.Mui-completed":{color:i}}}},MuiStepLabel:{styleOverrides:{label:{fontFamily:"Noto Serif JP"}}}}});return(0,n.jsx)(Z.Z,{theme:o,children:(0,n.jsx)(k.Z,{activeStep:t,alternativeLabel:!0,children:s.map(e=>(0,n.jsx)(y.Z,{children:(0,n.jsx)(f.Z,{title:e.description,arrow:!0,children:(0,n.jsx)(w.Z,{sx:{fontFamily:"Noto Serif JP"},children:e.label})})},e.label))})})},C=t(1369),R=t.n(C),T=t(78519),S=t(97928);let F=[{label:"下載驗證app",description:"下載 Google Authenticator 或其他相容的驗證應用程式。"},{label:"掃描QRcode",description:"掃描 QR 碼或手動輸入金鑰以設置驗證器。"},{label:"輸入驗證碼",description:"輸入應用程式中顯示的 6 位數驗證碼。"}];function z(){let[e,s]=(0,r.useState)({}),[t,l]=(0,r.useState)(0),[a,c]=(0,r.useState)(""),[u,d]=(0,r.useState)(""),[k,y]=(0,r.useState)(!1),{auth:w}=(0,o.aC)(),v=(0,i.useRouter)(),{openSnackbar:Z}=(0,S.Ds)(),C=async()=>{try{let e=await p.Z.post(h.op,{id:w.id});s(e.data)}catch(e){console.error("設置 OTP 失敗:",e),d("設置失敗，請稍後再試。")}},z=async()=>{6!==a.length&&Z("請填寫驗證碼","error");try{(await p.Z.post(h.ad,{id:w.id,token:a})).data.success?(Z("驗證成功！兩步驗證已設置。","success"),v.push("/user/profile")):Z("驗證失敗，請確認代碼是否正確。","error")}catch(e){console.error("驗證 TOTP 失敗:",e),Z("驗證失敗，請確認代碼是否正確。","error")}},O=e=>{window.open(e,"_blank")},Q=async()=>{try{await navigator.clipboard.writeText(e.secret),y(!0),setTimeout(()=>y(!1),3e3)}catch(e){console.error("複製失敗: ",e)}};return(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("section",{className:R().set2fa,children:[(0,n.jsxs)("div",{className:R().boxColumn,children:[(0,n.jsx)(T.Z,{text:"兩步驗證 (2FA)",href:w.id?"/user/profile":null}),(0,n.jsx)(N,{steps:F,activeStep:t})]}),0===t&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:R().boxColumn,children:[(0,n.jsx)("p",{children:"您可以透過驗證器應用程式取得驗證碼"}),(0,n.jsxs)("p",{children:["前往",(0,n.jsx)("span",{className:R().link,children:(0,n.jsx)(b.Z,{btnText:"Google Play",onClick:()=>{O("https://play.google.com/store/apps/details?id=com.google.android.apps.authenticator2&pli=1")}})}),"或",(0,n.jsx)("span",{className:R().link,children:(0,n.jsx)(b.Z,{btnText:"iOS App Store",className:R().btn,onClick:()=>{O("https://apps.apple.com/us/app/google-authenticator/id388497605")}})})]}),(0,n.jsx)("p",{children:"下載 Google Authenticator 驗證器"})]}),(0,n.jsx)("div",{className:R().boxRow,children:(0,n.jsx)(g.Z,{btnText:"開始設置",type:"button",href:null,onClick:()=>{C(),l(1)}})})]}),1===t&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:R().boxColumn,children:[(0,n.jsx)("p",{children:"請以驗證器掃描以下 QRcode："}),e.qrCode&&(0,n.jsx)(x(),{src:e.qrCode,width:250,height:250,alt:"QR Code"}),(0,n.jsx)("p",{children:"或複製金鑰："}),(0,n.jsxs)("div",{className:R().boxRow,children:[(0,n.jsx)("pre",{children:e.secret}),(0,n.jsx)(f.Z,{placement:"top",title:k?"已複製!":"複製金鑰",arrow:!0,children:(0,n.jsx)(m.Z,{onClick:Q,children:k?(0,n.jsx)(j.Qo6,{}):(0,n.jsx)(j.ef8,{})})})]})]}),(0,n.jsxs)("div",{className:R().boxRow,children:[(0,n.jsx)(g.Z,{btnText:"上一步",type:"button",href:null,onClick:()=>l(0)}),(0,n.jsx)(g.Z,{btnText:"下一步",type:"button",href:null,onClick:()=>l(2)})]})]}),2===t&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:R().boxColumn,children:[(0,n.jsx)("p",{children:"請輸入驗證器上顯示的 6 位數字："}),(0,n.jsx)(_.Z,{state:a,setState:c}),u&&(0,n.jsx)("p",{children:u})]}),(0,n.jsxs)("div",{className:R().boxRow,children:[(0,n.jsx)(g.Z,{btnText:"上一步",type:"button",href:null,onClick:()=>{c(""),l(1)}}),(0,n.jsx)(g.Z,{btnText:"驗證並完成設置",type:"button",href:null,onClick:z})]})]})]})})}function O(){let e=(0,i.useRouter)(),{auth:s,authIsReady:t}=(0,o.aC)(),{loginFormSwitch:d}=(0,l.NK)();return(0,r.useEffect)(()=>{e.isReady&&!s.id&&t&&(e.push("/"),d("Login"))},[s.id,t]),(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(a.Z,{title:"兩步驟驗證",pageName:"user",background:"light",children:(0,n.jsx)(u.Z,{userTab:(0,n.jsx)(c.Z,{}),sectionRight:(0,n.jsx)(z,{})})})})}},1369:function(e){e.exports={set2fa:"user-set-2fa_set2fa__gonB0",boxRow:"user-set-2fa_boxRow__a8RnF",boxColumn:"user-set-2fa_boxColumn__WxTg6",grow:"user-set-2fa_grow__oNsH5",link:"user-set-2fa_link__JQiu9"}},98216:function(e){e.exports={userTab:"user-tab_userTab__oitHd",active:"user-tab_active__WQZR9"}},5024:function(e){e.exports={sectionContainer:"user-layout_sectionContainer__ZrxdZ",sectionBody:"user-layout_sectionBody__cHqmz",sectionRight:"user-layout_sectionRight__pqtpQ"}}},function(e){e.O(0,[5970,4838,9317,4396,6660,509,2961,4321,8845,959,6497,7614,3210,3483,2888,9774,179],function(){return e(e.s=34494)}),_N_E=e.O()}]);